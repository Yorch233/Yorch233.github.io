import{_ as et,r as u,c as _,x as Pt,o as At,p as Qa,w as X,b as p,d as m,e as s,t as y,s as P,F as G,f as H,i as A,n as $,g as ra,T as It,v as Za,y as ye,z as Se,A as Ja}from"./index-CYMTJ9pp.js";const Et="/logo/icon.png",Kt="/assets/050a050v_c1_152_t60_1.57-DNo8cVUf.wav",qt="/assets/051o020a_c1_454_snr_5.2-CdviCkkA.wav",Wt="/assets/051o020t_c1_473_snr_8.3-DXotndtl.wav",Ft="/assets/053c010d_c1_896_snr_1.1-4ZRpcxme.wav",zt="/assets/053c010k_c1_903_snr_-5.0-CWAvcMMp.wav",Gt="/assets/22gc0110_c1_1161_t60_1.72-HCn2IUO0.wav",Ht="/assets/420c020o_c1_1633_t60_1.19-CZZILkBS.wav",jt="/assets/421c0214_c2_1769_t60_1.86-BwLoPT-M.wav",Ot="/assets/421o0307_c1_1896_snr_8.7-C2vI2qWK.wav",Ut="/assets/422c020d_c2_1982_t60_1.68-DKIeiLVA.wav",Vt="/assets/050a050v_c1_152_t60_1.57-BpZyqh7B.wav",Yt="/assets/051o020a_c1_454_snr_5.2-BhY7mBGc.wav",Qt="/assets/051o020t_c1_473_snr_8.3-BTvvsHpL.wav",Zt="/assets/053c010d_c1_896_snr_1.1-DSqvW6dW.wav",Jt="/assets/053c010k_c1_903_snr_-5.0-BUFH6a9r.wav",Xt="/assets/22gc0110_c1_1161_t60_1.72-C4wu8c4P.wav",es="/assets/420c020o_c1_1633_t60_1.19-BpRbwu1-.wav",as="/assets/421c0214_c2_1769_t60_1.86-Q7z4cpcW.wav",ts="/assets/421o0307_c1_1896_snr_8.7-rsrNDu-g.wav",ss="/assets/422c020d_c2_1982_t60_1.68-BpjeU09r.wav",ns="/assets/050a050v_c1_152_t60_1.57-CvhZDAyo.wav",os="/assets/051o020a_c1_454_snr_5.2-DYetsLjT.wav",rs="/assets/051o020t_c1_473_snr_8.3-CwOK4UG4.wav",ls="/assets/053c010d_c1_896_snr_1.1-DpfHFcYn.wav",is="/assets/053c010k_c1_903_snr_-5.0-DiaqB7a6.wav",cs="/assets/22gc0110_c1_1161_t60_1.72-DEQ4-1E8.wav",us="/assets/420c020o_c1_1633_t60_1.19-Cl8HdOAU.wav",ds="/assets/421c0214_c2_1769_t60_1.86-Cbo1o95C.wav",vs="/assets/421o0307_c1_1896_snr_8.7-DklYkS7I.wav",_s="/assets/422c020d_c2_1982_t60_1.68-65bJ9H90.wav",ps="/assets/050a050v_c1_152_t60_1.57-DqXrYtBJ.wav",ms="/assets/051o020a_c1_454_snr_5.2-CWhTvTAa.wav",hs="/assets/051o020t_c1_473_snr_8.3-qM_ibCXt.wav",gs="/assets/053c010d_c1_896_snr_1.1-BBcDxnp-.wav",fs="/assets/053c010k_c1_903_snr_-5.0-UQKnp7wS.wav",bs="/assets/22gc0110_c1_1161_t60_1.72-DjmWrned.wav",ws="/assets/420c020o_c1_1633_t60_1.19-DplED0NS.wav",ys="/assets/421c0214_c2_1769_t60_1.86-BKkjs79k.wav",Ss="/assets/421o0307_c1_1896_snr_8.7-CtAulGKl.wav",Ms="/assets/422c020d_c2_1982_t60_1.68-D95Z-yxq.wav",Rs="/assets/050a050v_c1_152_t60_1.57-BfOoGZjy.wav",Bs="/assets/051o020a_c1_454_snr_5.2-C4Y0qzGO.wav",ks="/assets/051o020t_c1_473_snr_8.3-Cv07XJiA.wav",xs="/assets/053c010d_c1_896_snr_1.1-CWrNQ9FV.wav",Cs="/assets/053c010k_c1_903_snr_-5.0-BP4JaKOh.wav",Ns="/assets/22gc0110_c1_1161_t60_1.72-CcNyNj2z.wav",$s="/assets/420c020o_c1_1633_t60_1.19-D7_rvMiY.wav",Ts="/assets/421c0214_c2_1769_t60_1.86-D6bCPskW.wav",Ls="/assets/421o0307_c1_1896_snr_8.7-D8ttMFfp.wav",Ds="/assets/422c020d_c2_1982_t60_1.68-BfRh0UNf.wav",Ps="/assets/050a050v_c1_152_t60_1.57-BDj51lym.wav",As="/assets/051o020a_c1_454_snr_5.2-C_wnR76_.wav",Is="/assets/051o020t_c1_473_snr_8.3-D9lIPD4L.wav",Es="/assets/053c010d_c1_896_snr_1.1-BPNjN9ef.wav",Ks="/assets/053c010k_c1_903_snr_-5.0-C1Hf_kB-.wav",qs="/assets/22gc0110_c1_1161_t60_1.72-CgmK3u29.wav",Ws="/assets/420c020o_c1_1633_t60_1.19-DcQrH1YJ.wav",Fs="/assets/421c0214_c2_1769_t60_1.86-CB09amZ6.wav",zs="/assets/421o0307_c1_1896_snr_8.7-D3VPf2Qg.wav",Gs="/assets/422c020d_c2_1982_t60_1.68-D4yo4deO.wav",Hs={class:"wave-header"},js={class:"wave-description"},Os={class:"wave-desc-item"},Us={key:0,class:"wave-desc-index"},Vs={class:"wave-desc-item"},Ys={class:"wave-desc-value"},Qs={class:"wave-desc-item wave-desc-tooltip"},Zs={class:"wave-desc-label"},Js={class:"wave-desc-value"},Xs={key:0,class:"wave-desc-tip"},en={class:"method-list"},an={class:"method-group method-group-primary"},tn=["onMouseenter"],sn=["disabled","onClick"],nn={class:"chip-label"},on={key:0,class:"chip-spinner","aria-hidden":"true"},rn={key:1,class:"chip-action","aria-hidden":"true"},ln=["src"],cn={key:0,class:"method-group method-group-secondary"},un={class:"method-group-scroll"},dn=["onMouseenter"],vn=["disabled","onClick"],_n={class:"chip-label"},pn={key:0,class:"chip-spinner","aria-hidden":"true"},mn={key:1,class:"chip-action","aria-hidden":"true"},hn=["src"],gn={class:"wave-panel"},fn={class:"wave-panel-header"},bn={class:"wave-panel-title"},wn={class:"wave-panel-actions"},yn={class:"view-toggle",role:"group","aria-label":"Visualization mode"},Sn={class:"wave-canvas-wrap","aria-hidden":"true"},Mn={key:0,class:"canvas-loading wave-loading"},Rn={class:"wave-time-axis","aria-hidden":"true"},Bn={class:"time-axis-track"},kn={class:"time-axis-label"},xn={class:"time-axis-caret-label"},Cn={class:"spectrogram-block","aria-hidden":"true"},Nn={class:"spectrogram-labels"},$n={class:"spectrogram-label"},Tn={class:"spectrogram-label"},Ln={class:"spectrogram-row"},Dn={class:"spectrogram-axis spectrogram-axis-y"},Pn={class:"spectrogram-axis-label"},An={class:"spectrogram-axis spectrogram-axis-x"},In={class:"spectrogram-axis-label"},En={key:0,class:"canvas-loading spectrogram-loading"},Kn={class:"spectrogram-axis spectrogram-axis-y"},qn={class:"spectrogram-axis-label"},Wn={class:"spectrogram-axis spectrogram-axis-x"},Fn={class:"spectrogram-axis-label"},zn={key:0,class:"spectrogram-placeholder"},Gn={key:1,class:"canvas-loading spectrogram-loading"},Hn={class:"spectrogram-controls","aria-hidden":"true"},jn={class:"spectrogram-quality"},On={class:"spectrogram-quality-options",role:"group","aria-label":"Spectrogram quality"},Un=["onClick"],Vn={class:"progress-row"},Yn=["aria-label"],Qn=["src","alt"],Zn={class:"time-label"},Jn=["value"],Xn={class:"time-label"},eo={class:"volume-control"},ao=["aria-label"],to=["src","alt"],so={class:"volume-popover"},no={class:"volume-label"},oo={class:"volume-slider-wrap"},ro=["value"],lo=["src"],io=40,co={__name:"AudioWaveCompare",props:{sampleName:{type:String,required:!0},sampleIndex:{type:Number,default:null},methods:{type:Array,default:()=>[]},defaultMethod:{type:String,default:"Measurement"},cleanKey:{type:String,default:"Ground_Truth"},measurementKey:{type:String,default:"Measurement"}},setup(la){var Ua;const x=u(100),i=la,j=[{key:"Ground_Truth",label:"Ground Truth (Clean)"},{key:"Measurement",label:"Measurement (Noisy/Reverb)"},{key:"NCSN+M",label:"NCSN+M"},{key:"SB",label:"SB"},{key:"StoRM",label:"StoRM"},{key:"RSB",label:"RSB (Ours)"}],T=_(()=>{var e;return(e=i.methods)!=null&&e.length?i.methods:j}),K=_(()=>{const e=[...T.value],a=e.find(r=>r.key===i.measurementKey),t=e.find(r=>r.key===i.cleanKey),n=e.filter(r=>r.key!==i.measurementKey&&r.key!==i.cleanKey);return[a,...n,t].filter(Boolean)}),g=u(i.defaultMethod),ee=u(null),ie=u(null),ce=u(null),ue=u(null),de=u(null),ae=u(null),C=u(null),Me=u(null),S=u(null),R=u(null),q=u(1),Z=u(0),f=u(0),ve=u(!1),ia=u(0),Ie=u(!1),ca=u(0),_e=u(null),pe=u(null),Ee=u(!1),Ve=u(!1),N=u("waveform"),O=u(!1),U=u(!1),V=u(!1),Ye=u({x:0,y:0}),J=u(!1),ua=u(!0),da=u(!0),Re=u(""),Be=u(""),W=u(!1),me=u(""),Ke=u({}),at=_(()=>ke(i.cleanKey)),qe=_(()=>ke(g.value)),tt=_(()=>ke(i.measurementKey));_(()=>{var e;return((e=T.value.find(a=>a.key===i.cleanKey))==null?void 0:e.label)||"Ground Truth"});const va=_(()=>{var e;return((e=T.value.find(a=>a.key===g.value))==null?void 0:e.label)||g.value}),_a=_(()=>{var e;return((e=T.value.find(a=>a.key===i.measurementKey))==null?void 0:e.label)||"Measurement"}),L=_(()=>g.value!==i.measurementKey),We=_(()=>ea[i.measurementKey]||"#ef4444"),Fe=_(()=>ea[g.value]||"#0a84ff"),Qe=_(()=>f.value?Z.value/f.value*100:0),st=_(()=>({background:`linear-gradient(90deg, #0a84ff 0%, #0a84ff ${Qe.value}%, #e2e8f0 ${Qe.value}%, #e2e8f0 100%)`})),nt=_(()=>Math.max(0,f.value-Z.value)),ot=_(()=>re(ia.value)),rt=_(()=>f.value?Z.value/f.value*100:0),he=_(()=>{if(!f.value||f.value<=0)return[];const e=[];for(let a=0;a<=Math.floor(f.value);a+=1)e.push(a);return e}),lt=_(()=>he.value.length?he.value[he.value.length-1]:0),pa=_(()=>[0,2,4,6,8]),it=_(()=>ve.value?"/logo/reload.svg":W.value?"/logo/player-pause.svg":"/logo/player-play.svg"),ma=_(()=>ve.value?"Replay":W.value?"Pause":"Play"),ct=_(()=>i.sampleName),ha=_(()=>Number.isFinite(i.sampleIndex)&&i.sampleIndex>0?`#${i.sampleIndex}`:""),ze=_(()=>{const e=i.sampleName.match(/snr=([\-\d]+(?:\.\d+)?)/i);if(e)return{label:"SNR",value:`${e[1]} dB`,tooltip:"Signal-to-noise ratio (SNR) measures speech strength relative to background noise. Higher is cleaner."};const a=i.sampleName.match(/t60=([\-\d]+(?:\.\d+)?)/i);return a?{label:"T60",value:`${a[1]} s`,tooltip:"Reverberation time (T60) is the time for sound to decay by 60 dB. Lower means less reverberation."}:{label:"Metric",value:"—",tooltip:""}}),ga=_(()=>Math.round(x.value)),ut=_(()=>x.value<=0?"/logo/volume-off.svg":x.value<100?"/logo/volume-2.svg":"/logo/volume.svg"),fa=_(()=>x.value<=0?"Mute":"Volume"),te=_(()=>pe.value??_e.value),dt=_(()=>te.value==="compare"?.1:1),vt=_(()=>te.value==="measurement"?.1:1),Ze=_(()=>{const e=L.value?.45:1;return te.value==="compare"?.1:pe.value==="measurement"?1:e}),Je=_(()=>te.value==="measurement"?.1:.9),ba=_(()=>Re.value||Be.value?Re.value||Be.value:""),wa=_(()=>O.value||U.value),se={instance:null,decodeContext:null},Ge=new Map,I=new Map,ne=u(1),Xe=_(()=>({1:1,2:1.6,3:2.2,4:3,5:4})[ne.value]??2.2),He=(Ua=Pt())==null?void 0:Ua.appContext.config.globalProperties.$messageBox,_t=async e=>{if(e!==ne.value){if(!(He!=null&&He.confirm)){ne.value=e;return}try{await He.confirm({title:"Spectrogram Quality",message:'Notice: Higher quality means longer rendering time. <span style="color:#ef4444;font-weight:600;">It may even cause the browser to crash. Please save any unsaved work in other tabs first.</span>',closeOnClickOverlay:!0}),ne.value=e}catch{}}},ea={Measurement:"#ff9d00",Ground_Truth:"#3b82f6","NCSN+M":"#22c55e","NCSN++M":"#22c55e",SB:"#a855f7",StoRM:"#14b8a6",RSB:"#f97316"},pt={Measurement:"Measurement is the degraded speech corrupted by noise and reverberation.",Ground_Truth:"Ground Truth is the original clean speech.","NCSN++M":"NCSN++M is a common backbone of diffusion models used here as a purely predictive method, trained with an MSE loss to predict clean speech.",SB:"SB models the transport between noisy and clean speech directly via Schrödinger Bridge. It is our baseline method.",StoRM:"StoRM is a hybrid method that cascades a predictive model with a diffusion model. The diffusion model refines details from the initial predictive estimate.",RSB:"RSB is the proposed method in this paper."},Y=(e,a)=>{Ke.value={...Ke.value,[e]:a}},oe=e=>Ke.value[e]==="ready",ke=e=>new URL(Object.assign({"../assets/RSB/audio/Ground_Truth/050a050v_c1_152_t60=1.57.wav":Kt,"../assets/RSB/audio/Ground_Truth/051o020a_c1_454_snr=5.2.wav":qt,"../assets/RSB/audio/Ground_Truth/051o020t_c1_473_snr=8.3.wav":Wt,"../assets/RSB/audio/Ground_Truth/053c010d_c1_896_snr=1.1.wav":Ft,"../assets/RSB/audio/Ground_Truth/053c010k_c1_903_snr=-5.0.wav":zt,"../assets/RSB/audio/Ground_Truth/22gc0110_c1_1161_t60=1.72.wav":Gt,"../assets/RSB/audio/Ground_Truth/420c020o_c1_1633_t60=1.19.wav":Ht,"../assets/RSB/audio/Ground_Truth/421c0214_c2_1769_t60=1.86.wav":jt,"../assets/RSB/audio/Ground_Truth/421o0307_c1_1896_snr=8.7.wav":Ot,"../assets/RSB/audio/Ground_Truth/422c020d_c2_1982_t60=1.68.wav":Ut,"../assets/RSB/audio/Measurement/050a050v_c1_152_t60=1.57.wav":Vt,"../assets/RSB/audio/Measurement/051o020a_c1_454_snr=5.2.wav":Yt,"../assets/RSB/audio/Measurement/051o020t_c1_473_snr=8.3.wav":Qt,"../assets/RSB/audio/Measurement/053c010d_c1_896_snr=1.1.wav":Zt,"../assets/RSB/audio/Measurement/053c010k_c1_903_snr=-5.0.wav":Jt,"../assets/RSB/audio/Measurement/22gc0110_c1_1161_t60=1.72.wav":Xt,"../assets/RSB/audio/Measurement/420c020o_c1_1633_t60=1.19.wav":es,"../assets/RSB/audio/Measurement/421c0214_c2_1769_t60=1.86.wav":as,"../assets/RSB/audio/Measurement/421o0307_c1_1896_snr=8.7.wav":ts,"../assets/RSB/audio/Measurement/422c020d_c2_1982_t60=1.68.wav":ss,"../assets/RSB/audio/NCSN++M/050a050v_c1_152_t60=1.57.wav":ns,"../assets/RSB/audio/NCSN++M/051o020a_c1_454_snr=5.2.wav":os,"../assets/RSB/audio/NCSN++M/051o020t_c1_473_snr=8.3.wav":rs,"../assets/RSB/audio/NCSN++M/053c010d_c1_896_snr=1.1.wav":ls,"../assets/RSB/audio/NCSN++M/053c010k_c1_903_snr=-5.0.wav":is,"../assets/RSB/audio/NCSN++M/22gc0110_c1_1161_t60=1.72.wav":cs,"../assets/RSB/audio/NCSN++M/420c020o_c1_1633_t60=1.19.wav":us,"../assets/RSB/audio/NCSN++M/421c0214_c2_1769_t60=1.86.wav":ds,"../assets/RSB/audio/NCSN++M/421o0307_c1_1896_snr=8.7.wav":vs,"../assets/RSB/audio/NCSN++M/422c020d_c2_1982_t60=1.68.wav":_s,"../assets/RSB/audio/RSB/050a050v_c1_152_t60=1.57.wav":ps,"../assets/RSB/audio/RSB/051o020a_c1_454_snr=5.2.wav":ms,"../assets/RSB/audio/RSB/051o020t_c1_473_snr=8.3.wav":hs,"../assets/RSB/audio/RSB/053c010d_c1_896_snr=1.1.wav":gs,"../assets/RSB/audio/RSB/053c010k_c1_903_snr=-5.0.wav":fs,"../assets/RSB/audio/RSB/22gc0110_c1_1161_t60=1.72.wav":bs,"../assets/RSB/audio/RSB/420c020o_c1_1633_t60=1.19.wav":ws,"../assets/RSB/audio/RSB/421c0214_c2_1769_t60=1.86.wav":ys,"../assets/RSB/audio/RSB/421o0307_c1_1896_snr=8.7.wav":Ss,"../assets/RSB/audio/RSB/422c020d_c2_1982_t60=1.68.wav":Ms,"../assets/RSB/audio/SB/050a050v_c1_152_t60=1.57.wav":Rs,"../assets/RSB/audio/SB/051o020a_c1_454_snr=5.2.wav":Bs,"../assets/RSB/audio/SB/051o020t_c1_473_snr=8.3.wav":ks,"../assets/RSB/audio/SB/053c010d_c1_896_snr=1.1.wav":xs,"../assets/RSB/audio/SB/053c010k_c1_903_snr=-5.0.wav":Cs,"../assets/RSB/audio/SB/22gc0110_c1_1161_t60=1.72.wav":Ns,"../assets/RSB/audio/SB/420c020o_c1_1633_t60=1.19.wav":$s,"../assets/RSB/audio/SB/421c0214_c2_1769_t60=1.86.wav":Ts,"../assets/RSB/audio/SB/421o0307_c1_1896_snr=8.7.wav":Ls,"../assets/RSB/audio/SB/422c020d_c2_1982_t60=1.68.wav":Ds,"../assets/RSB/audio/StoRM/050a050v_c1_152_t60=1.57.wav":Ps,"../assets/RSB/audio/StoRM/051o020a_c1_454_snr=5.2.wav":As,"../assets/RSB/audio/StoRM/051o020t_c1_473_snr=8.3.wav":Is,"../assets/RSB/audio/StoRM/053c010d_c1_896_snr=1.1.wav":Es,"../assets/RSB/audio/StoRM/053c010k_c1_903_snr=-5.0.wav":Ks,"../assets/RSB/audio/StoRM/22gc0110_c1_1161_t60=1.72.wav":qs,"../assets/RSB/audio/StoRM/420c020o_c1_1633_t60=1.19.wav":Ws,"../assets/RSB/audio/StoRM/421c0214_c2_1769_t60=1.86.wav":Fs,"../assets/RSB/audio/StoRM/421o0307_c1_1896_snr=8.7.wav":zs,"../assets/RSB/audio/StoRM/422c020d_c2_1982_t60=1.68.wav":Gs})[`../assets/RSB/audio/${e}/${i.sampleName}`],import.meta.url).href,xe=()=>{if(!se.instance){const e=window.AudioContext||window.webkitAudioContext;se.instance=new e}return se.instance},mt=()=>{if(!se.decodeContext){const e=window.OfflineAudioContext||window.webkitOfflineAudioContext;e?se.decodeContext=new e(1,1,44100):se.decodeContext=xe()}return se.decodeContext},je=async e=>{if(Ge.has(e))return Ge.get(e);const a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch audio: ${a.status}`);const t=await a.arrayBuffer(),n=mt();try{const r=await n.decodeAudioData(t.slice(0));return Ge.set(e,r),r}catch{const o=xe();if(o.state==="suspended")try{await o.resume()}catch{}const l=await o.decodeAudioData(t.slice(0));return Ge.set(e,l),l}},ya=e=>{const a=e.getChannelData(0);let t=0;for(let n=0;n<a.length;n+=1){const r=Math.abs(a[n]);r>t&&(t=r)}return t===0?1:.95/t},ht=()=>{var e,a,t,n,r,o,l,d,c;return g.value===i.measurementKey?((e=R.value)==null?void 0:e.duration)??((a=S.value)==null?void 0:a.duration)??((t=Me.value)==null?void 0:t.duration)??0:g.value===i.cleanKey?((n=Me.value)==null?void 0:n.duration)??((r=S.value)==null?void 0:r.duration)??((o=R.value)==null?void 0:o.duration)??0:((l=S.value)==null?void 0:l.duration)??((d=R.value)==null?void 0:d.duration)??((c=Me.value)==null?void 0:c.duration)??0},Sa=(e,a,t,n,r={})=>{if(!e||!a)return;const{color:o="#2563eb",alpha:l=1,scale:d=1}=r,c=a.getChannelData(0),v=Math.max(1,Math.floor(c.length/t)),b=n/2;e.strokeStyle=o,e.globalAlpha=l,e.lineWidth=1,e.beginPath();for(let M=0;M<t;M+=1){const w=M*v;let B=1,h=-1;for(let k=0;k<v;k+=1){const z=c[w+k]??0;z<B&&(B=z),z>h&&(h=z)}const E=Math.max(-1,Math.min(1,B*d)),D=Math.max(-1,Math.min(1,h*d));e.moveTo(M,(1+E)*b),e.lineTo(M,(1+D)*b)}e.stroke(),e.globalAlpha=1},Ma=e=>e.join("|"),aa=(e,a)=>{I.size>=io&&I.clear(),I.set(e,a)},Ra=e=>{const a=e.replace("#","");if(a.length!==6)return{r:15,g:23,b:42};const t=Number.parseInt(a,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},Ba=(e,a,t)=>{const n=Ra(e),r=Ra(a),o=Math.min(1,Math.max(0,t)),l=Math.round(n.r+(r.r-n.r)*o),d=Math.round(n.g+(r.g-n.g)*o),c=Math.round(n.b+(r.b-n.b)*o);return`rgb(${l}, ${d}, ${c})`},ka=(e,a,t,n,r,o,l)=>{const d=()=>{if(!R.value)return;e.save(),e.beginPath(),e.rect(0,r,n,o),e.clip(),e.save(),e.translate(0,r);const v=l==="muted"?Ba(We.value,"#f8fafc",.65):We.value;Sa(e,R.value,n,o,{color:v,alpha:Ze.value,scale:q.value}),e.restore(),e.restore()},c=()=>{if(!S.value||!L.value)return;e.save(),e.beginPath(),e.rect(0,r,n,o),e.clip(),e.save(),e.translate(0,r);const v=l==="muted"?Ba(Fe.value,"#f8fafc",.65):Fe.value;Sa(e,S.value,n,o,{color:v,alpha:Je.value,scale:q.value}),e.restore(),e.restore()};te.value==="measurement"?(c(),d()):(te.value,d(),c())},xa=(e,a,t,n,r,o)=>{const l=r+o/2,d=o/2;[1,.5,0,-.5,-1].forEach(v=>{const b=l-v*d;e.beginPath(),e.lineWidth=v===0?1.4:1,e.strokeStyle=v===0?"rgba(148, 163, 184, 0.55)":"rgba(148, 163, 184, 0.25)",e.moveTo(0,b),e.lineTo(n,b),e.stroke()})},Ca=(e,a,t,n,r)=>{const o=n+r/2,l=r/2,d=[1,.5,0,-.5,-1],c=a-6;e.font='10px "Times New Roman", serif',e.textAlign="right",e.textBaseline="middle",e.fillStyle="rgba(100, 116, 139, 0.9)",d.forEach(v=>{const b=o-v*l;e.fillText(v.toFixed(1),c,b)})},Na=(e,a,t,n)=>{if(!Number.isFinite(n))return;const r=W.value?.6+.4*Math.sin(performance.now()*.008):1;e.beginPath(),e.lineWidth=J.value?2.6:1.3,e.strokeStyle=`rgba(148, 163, 184, ${.8*r})`,e.moveTo(n,0),e.lineTo(n,t),e.stroke()},F=()=>{if(N.value==="spectrogram"){U.value=!0,La(),O.value=!1;return}const e=ie.value;if(!e){O.value=!1;return}const a=e.getBoundingClientRect(),t=a.height||110,n=a.width||480,r=window.devicePixelRatio||1;e.width=n*r,e.height=t*r;const o=e.getContext("2d");if(!o){O.value=!1;return}const l=Ma(["waveform",i.sampleName,g.value,te.value??"none",L.value?"1":"0",R.value?"m1":"m0",S.value?"c1":"c0",q.value,We.value,Fe.value,Ze.value,Je.value,n,t,r]),d=`${l}|normal`,c=`${l}|muted`,v=I.get(d),b=I.get(c);o.setTransform(r,0,0,r,0,0),o.clearRect(0,0,n,t);const M=28,w=10,B=10,h=Math.max(0,n-M),E=Math.max(0,t-w-B),D=f.value?Z.value/f.value*h:0;if(v&&b){O.value=!1,xa(o,n,t,h,w,E),o.save(),o.globalAlpha=1,o.beginPath(),o.rect(0,0,Math.max(0,Math.min(h,D)),t),o.clip(),o.drawImage(v,0,0,n,t),o.restore(),o.save(),o.beginPath(),o.rect(Math.max(0,Math.min(h,D)),0,h,t),o.clip(),o.drawImage(b,0,0,n,t),o.restore(),Ca(o,n,t,w,E),Na(o,h,t,D),e.style.opacity="1";return}e.style.opacity="0",O.value=!0;const k=document.createElement("canvas");k.width=n*r,k.height=t*r;const z=k.getContext("2d");if(!z){O.value=!1;return}z.setTransform(r,0,0,r,0,0),ka(z,n,t,h,w,E,"normal"),aa(d,k);const le=document.createElement("canvas");le.width=n*r,le.height=t*r;const be=le.getContext("2d");be&&(be.setTransform(r,0,0,r,0,0),ka(be,n,t,h,w,E,"muted"),aa(c,le)),xa(o,n,t,h,w,E),o.save(),o.globalAlpha=1,o.beginPath(),o.rect(0,0,Math.max(0,Math.min(h,D)),t),o.clip(),o.drawImage(k,0,0,n,t),o.restore(),o.save(),o.beginPath(),o.rect(Math.max(0,Math.min(h,D)),0,h,t),o.clip(),o.drawImage(le,0,0,n,t),o.restore(),Ca(o,n,t,w,E),Na(o,h,t,D),requestAnimationFrame(()=>{e.style.opacity="1",O.value=!1})},Ce=[[0,0,0,4],[.1,25,6,64],[.2,53,11,99],[.3,84,21,117],[.4,113,31,126],[.5,142,41,122],[.6,170,54,99],[.7,198,72,70],[.8,225,101,40],[.9,246,136,22],[1,252,181,20]],gt=()=>{switch(ne.value){case 1:return{fftSize:512,hopLength:256};case 2:return{fftSize:512,hopLength:128};case 3:return{fftSize:1024,hopLength:128};case 4:return{fftSize:1024,hopLength:64};case 5:return{fftSize:2048,hopLength:64};default:return{fftSize:1024,hopLength:128}}},ft=e=>{const a=Math.min(1,Math.max(0,e));for(let n=0;n<Ce.length-1;n+=1){const[r,o,l,d]=Ce[n],[c,v,b,M]=Ce[n+1];if(a>=r&&a<=c){const w=(a-r)/(c-r);return{r:Math.round(o+(v-o)*w),g:Math.round(l+(b-l)*w),b:Math.round(d+(M-d)*w)}}}const t=Ce[Ce.length-1];return{r:t[1],g:t[2],b:t[3]}},bt=(e,a,t,n,r)=>{const o=a.getChannelData(0),{fftSize:l,hopLength:d}=gt(),c=l/2,v=Math.max(1,Math.floor((o.length-l)/d)+1),b=new Float32Array(l);for(let k=0;k<l;k+=1)b[k]=.5-.5*Math.cos(2*Math.PI*k/(l-1));const M=-60,w=0,B=1e-10,h=a.sampleRate/2,D=Math.min(c,Math.max(8,Math.floor(1e4/h*c)));for(let k=0;k<t;k+=1){const z=Math.min(v-1,Math.floor(k/t*v)),le=Math.min(z*d,Math.max(0,o.length-l)),be=new Float32Array(c);for(let Q=0;Q<c;Q+=1){let De=0,we=0;for(let Ae=0;Ae<l;Ae+=1){const Va=(o[le+Ae]||0)*b[Ae],Ya=2*Math.PI*Q*Ae/l;De+=Va*Math.cos(Ya),we-=Va*Math.sin(Ya)}const Pe=Math.sqrt(De*De+we*we),Dt=20*Math.log10(.1*Pe+B);be[Q]=Math.min(1,Math.max(0,(Dt-M)/(w-M)))}for(let Q=0;Q<n;Q+=1){const De=Math.floor(Q/n*D),we=be[De]||0;if(we<=0)continue;const Pe=ft(we);e.fillStyle=`rgb(${Pe.r}, ${Pe.g}, ${Pe.b})`,e.fillRect(k,n-Q-1,1,1)}}},Oe=(e,a,t,n)=>{if(!e||!a)return;const r=e.getBoundingClientRect(),o=r.height||110,l=r.width||240,d=(window.devicePixelRatio||1)*Xe.value,c=Math.max(1,Math.floor(l*d)),v=Math.max(1,Math.floor(o*d)),b=`${t}|${l}|${o}|${d}`;e.width=c,e.height=v;const M=e.getContext("2d");if(!M)return;const w=I.get(b);if(M.setTransform(1,0,0,1,0,0),M.clearRect(0,0,c,v),w){M.drawImage(w,0,0,c,v);return}const B=document.createElement("canvas");B.width=c,B.height=v;const h=B.getContext("2d");h&&(h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,c,v),h.fillStyle="#0b0f16",h.fillRect(0,0,c,v),bt(h,a,c,v),aa(b,B),M.drawImage(B,0,0,c,v))},$a=(e,a)=>{if(!e||!a||!V.value)return;const t=e.getBoundingClientRect(),n=t.width||0,r=t.height||0;if(!n||!r)return;const o=window.devicePixelRatio||1;a.width=n*o,a.height=r*o;const l=a.getContext("2d");if(!l)return;l.setTransform(o,0,0,o,0,0),l.clearRect(0,0,n,r);const d=2.2,c=140,v=90,b=Math.min(1,Math.max(0,Ye.value.x)),M=Math.min(1,Math.max(0,Ye.value.y));let w=b*n-c/2,B=M*r-v/2;w=Math.min(Math.max(0,w),n-c),B=Math.min(Math.max(0,B),r-v);const h=w*(e.width/n),E=B*(e.height/r),D=c/d*(e.width/n),k=v/d*(e.height/r);l.imageSmoothingEnabled=!0,l.drawImage(e,h,E,D,k,w,B,c,v),l.lineWidth=1.5,l.strokeStyle="rgba(255, 255, 255, 0.9)",l.strokeRect(w+.5,B+.5,c-1,v-1)},Ne=e=>{if(!e)return;const a=e.getBoundingClientRect(),t=a.width||0,n=a.height||0,r=window.devicePixelRatio||1;e.width=t*r,e.height=n*r;const o=e.getContext("2d");o&&(o.setTransform(r,0,0,r,0,0),o.clearRect(0,0,t,n))},Ta=()=>{$a(ce.value,de.value),L.value?$a(ue.value,ae.value):Ne(ae.value)},Ue=e=>{if(!e)return;const a=e.getBoundingClientRect(),t=a.height||110,n=a.width||240,r=(window.devicePixelRatio||1)*Xe.value,o=Math.max(1,Math.floor(n*r)),l=Math.max(1,Math.floor(t*r));e.width=o,e.height=l;const d=e.getContext("2d");d&&(d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,o,l),d.fillStyle="#0b0f16",d.fillRect(0,0,o,l))},La=()=>{const e=ce.value,a=ue.value;if(!e||!a){U.value=!1;return}const t=Ma(["spectrogram",i.sampleName,g.value,Ze.value,Je.value]),n=(c,v)=>{const b=c.getBoundingClientRect(),M=b.height||110,w=b.width||240,B=(window.devicePixelRatio||1)*Xe.value;return`${t}${v}|${w}|${M}|${B}`},r=n(e,"|left"),o=n(a,"|right"),l=I.has(r),d=!L.value||I.has(o);if(l&&d){Oe(e,R.value,`${t}|left`),S.value&&L.value?Oe(a,S.value,`${t}|right`):Ue(a),U.value=!1;return}U.value=!0,Ue(e),Ue(a),requestAnimationFrame(()=>{window.setTimeout(()=>{R.value&&Oe(e,R.value,`${t}|left`),S.value&&L.value?Oe(a,S.value,`${t}|right`):Ue(a),requestAnimationFrame(()=>{U.value=!1,V.value&&Ta()})},0)})},wt=async()=>{try{const e=await je(tt.value);R.value=e,q.value=ya(e),Y(i.measurementKey,"ready"),F()}catch{R.value=null,q.value=1,Y(i.measurementKey,"error")}},yt=async()=>{ua.value=!0,Re.value="";try{const e=await je(at.value);Me.value=e,Y(i.cleanKey,"ready"),F()}catch{Re.value="Load failed",Y(i.cleanKey,"error")}finally{ua.value=!1}},Da=async()=>{da.value=!0,Be.value="";try{const e=await je(qe.value);S.value=e,Y(g.value,"ready"),g.value===i.measurementKey&&!R.value&&(R.value=e,q.value=ya(e)),(!Number.isFinite(f.value)||f.value<=0)&&(f.value=e.duration||0),F()}catch{Be.value="Load failed",Y(g.value,"error")}finally{da.value=!1}},St=()=>{F()},Mt=async e=>{const a=C.value;if(!a||!oe(e))return;za();const t=xe();if(t.state==="suspended")try{await t.resume()}catch{}const n=ke(e);if(me.value===e&&!a.paused){a.pause();return}a.src!==n&&(a.src=n);try{await a.play(),me.value=e}catch{}},Pa=e=>{oe(e)&&(g.value=e,Mt(e))},Rt=()=>{const e=C.value;if(!e||!oe(g.value))return;za();const a=xe();a.state==="suspended"&&a.resume().catch(()=>{}),e.src!==qe.value&&(e.src=qe.value),ve.value&&(e.currentTime=0),e.paused?e.play():e.pause()},Bt=e=>e===i.measurementKey?"measurement":e===i.cleanKey?"ground-truth":"method",kt=_(()=>K.value.filter(e=>e.key===i.measurementKey||e.key===i.cleanKey)),Aa=_(()=>K.value.filter(e=>e.key!==i.measurementKey&&e.key!==i.cleanKey)),Ia=e=>({"--method-color":ea[e]||"#94a3b8"}),Ea=e=>W.value&&me.value===e?"/logo/player-pause.svg":"/logo/player-play.svg",ge=u({text:"",x:0,y:0,visible:!1});let ta=0;const Ka=(e,a)=>{const t=pt[a];if(!t)return;window.clearTimeout(ta);const n=e.currentTarget.getBoundingClientRect();ta=window.setTimeout(()=>{ge.value={text:t,x:n.left,y:n.bottom+10,visible:!0}},1e3)},qa=()=>{window.clearTimeout(ta),ge.value={text:"",x:0,y:0,visible:!1}},Wa=e=>{if(pe.value){pe.value=null;return}pe.value=e};let sa=null,fe=null;const Fa=e=>{const a=C.value;if(!a)return;const t=Math.min(2,Math.max(0,e/100));if(fe){fe.gain.value=t;return}a.volume=Math.min(1,t)},za=()=>{const e=C.value;if(!e||sa)return;const a=xe();sa=a.createMediaElementSource(e),fe=a.createGain(),fe.gain.value=Math.min(2,Math.max(0,x.value/100)),sa.connect(fe),fe.connect(a.destination),e.volume=1},xt=e=>{const a=Number(e.target.value);Number.isFinite(a)&&(x.value=Math.min(200,Math.max(0,a)))},Ct=()=>{K.value.forEach(e=>{if(!(e!=null&&e.key))return;Y(e.key,"loading");const a=ke(e.key);je(a).then(()=>{Y(e.key,"ready")}).catch(()=>{Y(e.key,"error")})})},Nt=e=>{const a=C.value;if(!a||!f.value)return;const t=Number(e.target.value);a.currentTime=t/100*f.value},$t=e=>{if(!C.value||!f.value)return;const t=e.currentTarget.getBoundingClientRect(),n=Math.min(Math.max(0,e.clientX-t.left),t.width),r=t.width?n/t.width:0;ia.value=r*f.value,ca.value=n,Ie.value=!0},Tt=()=>{Ie.value=!1},Ga=(e,a)=>{if(N.value!=="spectrogram")return;const t=a==="right"?ue.value:ce.value;if(!t)return;const n=t.getBoundingClientRect(),r=Math.min(Math.max(0,e.clientX-n.left),n.width),o=Math.min(Math.max(0,e.clientY-n.top),n.height);Ye.value={x:n.width?r/n.width:0,y:n.height?o/n.height:0},V.value=!0,Ta()},Ha=()=>{V.value=!1,Ne(de.value),Ne(ae.value)},re=(e,a=!1)=>{if(!Number.isFinite(e))return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);if(!a)return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}`;const r=Math.floor((e-Math.floor(e))*1e3);return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}.${String(r).padStart(3,"0")}`};let $e=0,ja=0;const na=()=>{const e=C.value;if(!e)return;const a=performance.now();if(a-ja<10)return;ja=a,Z.value=e.currentTime||0;const t=Number.isFinite(e.duration)&&e.duration>0?e.duration:ht();f.value=t||0,N.value==="waveform"&&F()},Lt=()=>{const e=()=>{na(),$e=requestAnimationFrame(e)};cancelAnimationFrame($e),$e=requestAnimationFrame(e)},oa=()=>{cancelAnimationFrame($e),$e=0};let Te,Le;const Oa=()=>{Ve.value||!Ee.value||(Ve.value=!0,Ct(),wt(),yt(),Da())};return At(()=>{if(T.value.map(a=>a.key).includes(g.value)||(g.value=i.measurementKey),Te=new ResizeObserver(()=>{St()}),ee.value&&Te.observe(ee.value),ee.value&&(Le=new IntersectionObserver(a=>{const t=a[0];Ee.value=!!(t!=null&&t.isIntersecting),Ee.value&&Oa()},{root:null,threshold:.15}),Le.observe(ee.value)),C.value&&(Fa(x.value),C.value.addEventListener("play",()=>{W.value=!0,ve.value=!1,Lt()}),C.value.addEventListener("pause",()=>{W.value=!1,oa()}),C.value.addEventListener("ended",()=>{W.value=!1,ve.value=!0,oa()}),C.value.addEventListener("loadedmetadata",()=>{na()}),C.value.addEventListener("timeupdate",()=>{na()})),ie.value){const a=ie.value,t=r=>{if(N.value!=="waveform"){J.value=!1;return}if(!f.value){J.value=!1;return}const o=a.getBoundingClientRect(),l=Math.min(Math.max(0,r.clientX-o.left),o.width),c=Math.max(0,o.width-28),v=Z.value/f.value*c,b=Math.abs(l-v)<=4;b!==J.value&&(J.value=b,F())},n=()=>{J.value&&(J.value=!1,F())};a.addEventListener("mousemove",t),a.addEventListener("mouseleave",n),Qa(()=>{a.removeEventListener("mousemove",t),a.removeEventListener("mouseleave",n)})}}),Qa(()=>{Te==null||Te.disconnect(),Le==null||Le.disconnect(),oa(),I.clear()}),X(()=>i.sampleName,()=>{Ke.value={},I.clear(),Ve.value=!1,Ee.value&&Oa()}),X(()=>g.value,()=>{ve.value=!1,W.value=!1,me.value="",Da()}),X(()=>_e.value,()=>{F()}),X(()=>pe.value,()=>{F()}),X(()=>N.value,()=>{N.value==="spectrogram"&&(U.value=!0),N.value!=="spectrogram"&&(V.value=!1,Ne(de.value),Ne(ae.value)),F()}),X(()=>i.defaultMethod,e=>{g.value=e}),X(()=>x.value,e=>{Fa(e)}),X(()=>ne.value,()=>{I.clear(),N.value==="spectrogram"&&La()}),(e,a)=>(p(),m("section",{ref_key:"containerRef",ref:ee,class:"wave-compare"},[s("header",Hs,[s("div",js,[s("span",Os,[ha.value?(p(),m("span",Us,y(ha.value),1)):P("",!0)]),s("span",Vs,[a[10]||(a[10]=s("span",{class:"wave-desc-label"},"Sample name",-1)),s("span",Ys,y(ct.value),1)]),a[11]||(a[11]=s("span",{class:"wave-desc-divider","aria-hidden":"true"},null,-1)),s("span",Qs,[s("span",Zs,y(ze.value.label),1),s("span",Js,y(ze.value.value),1),ze.value.tooltip?(p(),m("span",Xs,y(ze.value.tooltip),1)):P("",!0)])])]),s("div",en,[s("div",an,[(p(!0),m(G,null,H(kt.value,t=>(p(),m("div",{key:t.key,class:"method-chip-wrap",onMouseenter:n=>Ka(n,t.key),onMouseleave:qa},[s("button",{class:A(["method-chip",[`method-chip-${Bt(t.key)}`,{active:g.value===t.key,playing:W.value&&me.value===t.key}]]),style:$(Ia(t.key)),disabled:!oe(t.key)||wa.value,onClick:n=>Pa(t.key),type:"button"},[a[12]||(a[12]=s("span",{class:"chip-dot","aria-hidden":"true"},null,-1)),s("span",nn,y(t.label),1),oe(t.key)?(p(),m("span",rn,[s("img",{class:"icon-img",src:Ea(t.key),alt:""},null,8,ln)])):(p(),m("span",on))],14,sn)],40,tn))),128))]),Aa.value.length?(p(),m("div",cn,[a[14]||(a[14]=s("span",{class:"method-group-label"},"Methods",-1)),s("div",un,[(p(!0),m(G,null,H(Aa.value,t=>(p(),m("div",{key:t.key,class:"method-chip-wrap",onMouseenter:n=>Ka(n,t.key),onMouseleave:qa},[s("button",{class:A(["method-chip method-chip-secondary",{active:g.value===t.key,playing:W.value&&me.value===t.key}]),style:$(Ia(t.key)),disabled:!oe(t.key)||wa.value,onClick:n=>Pa(t.key),type:"button"},[a[13]||(a[13]=s("span",{class:"chip-dot","aria-hidden":"true"},null,-1)),s("span",_n,y(t.label),1),oe(t.key)?(p(),m("span",mn,[s("img",{class:"icon-img",src:Ea(t.key),alt:""},null,8,hn)])):(p(),m("span",pn))],14,vn)],40,dn))),128))])])):P("",!0)]),(p(),ra(It,{to:"body"},[ge.value.visible?(p(),m("div",{key:0,class:"method-tip-global",style:$({left:`${ge.value.x}px`,top:`${ge.value.y}px`})},y(ge.value.text),5)):P("",!0)])),s("div",gn,[s("div",fn,[s("div",bn,[s("span",{class:"legend-item",style:$({opacity:dt.value}),onMouseenter:a[0]||(a[0]=t=>_e.value="measurement"),onMouseleave:a[1]||(a[1]=t=>_e.value=null),onClick:a[2]||(a[2]=t=>Wa("measurement"))},[s("span",{class:"legend-swatch legend-measurement","aria-hidden":"true",style:$({background:We.value})},null,4),Za(" "+y(_a.value),1)],36),L.value?(p(),m("span",{key:0,class:"legend-item",style:$({opacity:vt.value}),onMouseenter:a[3]||(a[3]=t=>_e.value="compare"),onMouseleave:a[4]||(a[4]=t=>_e.value=null),onClick:a[5]||(a[5]=t=>Wa("compare"))},[s("span",{class:"legend-swatch legend-compare","aria-hidden":"true",style:$({background:Fe.value})},null,4),Za(" "+y(va.value),1)],36)):P("",!0)]),s("div",wn,[s("div",yn,[s("button",{class:A(["view-toggle-btn",{active:N.value==="waveform"}]),onClick:a[6]||(a[6]=t=>N.value="waveform"),type:"button"},"Waveform",2),s("button",{class:A(["view-toggle-btn",{active:N.value==="spectrogram"}]),onClick:a[7]||(a[7]=t=>N.value="spectrogram"),type:"button"},"Spectrogram",2)]),ba.value?(p(),m("span",{key:0,class:A(["wave-status",{"wave-status-error":Re.value||Be.value}])},y(ba.value),3)):P("",!0)])]),ye(s("div",Sn,[s("canvas",{ref_key:"combinedCanvasRef",ref:ie,class:"wave-canvas"},null,512),O.value?(p(),m("div",Mn,"Loading...")):P("",!0)],512),[[Se,N.value==="waveform"]]),ye(s("div",Rn,[s("div",Bn,[(p(!0),m(G,null,H(he.value,t=>(p(),m("span",{key:t,class:A(["time-axis-tick",{"is-major":t%2===0,"is-start":t===0,"is-end":t===lt.value}]),style:$({left:`${f.value?t/f.value*100:0}%`})},[a[15]||(a[15]=s("span",{class:"time-axis-line"},null,-1)),s("span",kn,y(t%2===0?re(t):""),1)],6))),128)),J.value?(p(),m("div",{key:0,class:"time-axis-caret",style:$({left:`${rt.value}%`})},[s("span",xn,y(re(Z.value,!0)),1)],4)):P("",!0)])],512),[[Se,N.value==="waveform"]]),ye(s("div",Cn,[s("div",Nn,[s("span",$n,y(_a.value),1),a[16]||(a[16]=s("span",{class:"spectrogram-gap"},null,-1)),s("span",Tn,y(L.value?va.value:""),1)]),s("div",Ln,[s("div",{class:A(["spectrogram-side",{"spectrogram-hovering":V.value}]),onMousemove:a[8]||(a[8]=t=>Ga(t,"left")),onMouseleave:Ha},[s("canvas",{ref_key:"spectrogramLeftRef",ref:ce,class:"spectrogram-canvas"},null,512),ye(s("canvas",{ref_key:"spectrogramZoomLeftRef",ref:de,class:"spectrogram-zoom-canvas"},null,512),[[Se,V.value]]),s("div",Dn,[a[18]||(a[18]=s("span",{class:"spectrogram-axis-title"},"Frequency[kHz]",-1)),(p(!0),m(G,null,H(pa.value,t=>(p(),m("span",{key:`y-${t}`,class:"spectrogram-axis-tick",style:$({top:`${100-t/8*100}%`})},[a[17]||(a[17]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",Pn,y(t),1)],4))),128))]),s("div",An,[(p(!0),m(G,null,H(he.value,t=>(p(),m("span",{key:`x-left-${t}`,class:A(["spectrogram-axis-tick",{"is-major":t%2===0}]),style:$({left:`${f.value?t/f.value*100:0}%`})},[a[19]||(a[19]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",In,y(t%2===0?re(t):""),1)],6))),128))]),U.value?(p(),m("div",En,"Loading...")):P("",!0)],34),a[23]||(a[23]=s("div",{class:"spectrogram-gap"},null,-1)),s("div",{class:A(["spectrogram-side",{"spectrogram-hovering":V.value}]),onMousemove:a[9]||(a[9]=t=>Ga(t,"right")),onMouseleave:Ha},[s("canvas",{ref_key:"spectrogramRightRef",ref:ue,class:"spectrogram-canvas"},null,512),ye(s("canvas",{ref_key:"spectrogramZoomRightRef",ref:ae,class:"spectrogram-zoom-canvas"},null,512),[[Se,V.value&&L.value]]),s("div",Kn,[a[21]||(a[21]=s("span",{class:"spectrogram-axis-title"},"Frequency[kHz]",-1)),(p(!0),m(G,null,H(pa.value,t=>(p(),m("span",{key:`y2-${t}`,class:"spectrogram-axis-tick",style:$({top:`${100-t/8*100}%`})},[a[20]||(a[20]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",qn,y(t),1)],4))),128))]),s("div",Wn,[(p(!0),m(G,null,H(he.value,t=>(p(),m("span",{key:`x-right-${t}`,class:A(["spectrogram-axis-tick",{"is-major":t%2===0}]),style:$({left:`${f.value?t/f.value*100:0}%`})},[a[22]||(a[22]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",Fn,y(t%2===0?re(t):""),1)],6))),128))]),L.value?P("",!0):(p(),m("span",zn,"Select a method")),U.value&&L.value?(p(),m("div",Gn,"Loading...")):P("",!0)],34)])],512),[[Se,N.value==="spectrogram"]]),ye(s("div",Hn,[a[25]||(a[25]=s("div",{class:"spectrogram-colorbar-wrap","aria-label":"Spectrogram energy scale"},[s("span",{class:"spectrogram-colorbar-label"},"0 dB"),s("div",{class:"spectrogram-colorbar"}),s("span",{class:"spectrogram-colorbar-label"},"-60 dB")],-1)),s("div",jn,[a[24]||(a[24]=s("span",{class:"spectrogram-quality-label"},"Quality",-1)),s("div",On,[(p(),m(G,null,H([1,2,3,4,5],t=>s("button",{key:`quality-${t}`,class:A(["spectrogram-quality-option",{active:ne.value===t}]),onClick:n=>_t(t),type:"button"},y(t),11,Un)),64))])])],512),[[Se,N.value==="spectrogram"]]),s("div",Vn,[s("button",{class:"progress-play",type:"button",onClick:Rt,"aria-label":ma.value},[s("img",{class:"icon-img",src:it.value,alt:ma.value},null,8,Qn)],8,Yn),s("span",Zn,y(re(Z.value)),1),s("div",{class:A(["progress-track",{"progress-track-hover":Ie.value}]),onMousemove:$t,onMouseleave:Tt},[s("input",{class:"progress-bar",type:"range",min:"0",max:"100",step:"0.1",value:Qe.value,style:$(st.value),onInput:Nt},null,44,Jn),Ie.value?(p(),m("div",{key:0,class:"progress-tooltip",style:$({left:`${ca.value}px`})},y(ot.value),5)):P("",!0)],34),s("span",Xn,"-"+y(re(nt.value)),1),s("div",eo,[s("button",{class:"volume-button",type:"button","aria-label":fa.value},[s("img",{class:"icon-img",src:ut.value,alt:fa.value},null,8,to)],8,ao),s("div",so,[s("div",no,y(ga.value),1),s("div",oo,[s("input",{class:"volume-slider",type:"range",min:"0",max:"200",step:"1",value:ga.value,onInput:xt},null,40,ro)]),a[26]||(a[26]=s("div",{class:"volume-scale"},"0–200",-1))])])]),s("audio",{ref_key:"audioRef",ref:C,class:"wave-audio",src:qe.value,preload:"metadata"},null,8,lo)])],512))}},Xa=et(co,[["__scopeId","data-v-44a5bff6"]]),uo={class:"rsb-page"},vo={class:"rsb-article"},_o={class:"rsb-section rsb-fade rsb-delay-5"},po={class:"rsb-audio-group"},mo={class:"rsb-audio-list"},ho={class:"rsb-audio-actions"},go=["disabled"],fo=["disabled"],bo={class:"rsb-audio-group"},wo={class:"rsb-audio-list"},yo={class:"rsb-audio-actions"},So=["disabled"],Mo=["disabled"],Ro={__name:"RSB",setup(la){const x=["051o020a_c1_454_snr=5.2.wav","051o020t_c1_473_snr=8.3.wav","053c010d_c1_896_snr=1.1.wav","053c010k_c1_903_snr=-5.0.wav","421o0307_c1_1896_snr=8.7.wav"],i=["050a050v_c1_152_t60=1.57.wav","22gc0110_c1_1161_t60=1.72.wav","420c020o_c1_1633_t60=1.19.wav","421c0214_c2_1769_t60=1.86.wav","422c020d_c2_1982_t60=1.68.wav"],j=u(!1),T=u(!1),K=u(0),g=u(0),ee=_(()=>j.value?x:[x[K.value]??x[0]].filter(Boolean)),ie=_(()=>T.value?i:[i[g.value]??i[0]].filter(Boolean)),ce=()=>{x.length&&(K.value=(K.value-1+x.length)%x.length)},ue=()=>{x.length&&(K.value=(K.value+1)%x.length)},de=()=>{i.length&&(g.value=(g.value-1+i.length)%i.length)},ae=()=>{i.length&&(g.value=(g.value+1)%i.length)},C=[{key:"Ground_Truth",label:"Ground Truth"},{key:"Measurement",label:"Measurement"},{key:"NCSN++M",label:"NCSN++M"},{key:"StoRM",label:"StoRM"},{key:"SB",label:"SB"},{key:"RSB",label:"RSB (Ours)"}];return(Me,S)=>(p(),m("section",uo,[s("article",vo,[S[5]||(S[5]=Ja('<img class="rsb-watermark" src="'+Et+'" alt="" aria-hidden="true" data-v-1364315d><header class="rsb-hero rsb-fade rsb-delay-1" data-v-1364315d><p class="rsb-kicker" data-v-1364315d>Paper demo</p><h1 class="rsb-title" data-v-1364315d> Regularized <span class="rsb-highlight" data-v-1364315d>Schrödinger Bridge</span> via Distortion-Perception Perturbation for High-Fidelity <span class="rsb-highlight" data-v-1364315d>Speech Enhancement</span></h1><p class="rsb-authors" data-v-1364315d><span class="rsb-author" data-v-1364315d><span class="rsb-author-name" data-v-1364315d> Qing Yao <sup data-v-1364315d>1</sup></span><span class="rsb-email" data-v-1364315d>qyao@stmail.ujs.edu.cn</span></span><span class="rsb-author" data-v-1364315d><span class="rsb-author-name" data-v-1364315d> Lijian Gao <sup data-v-1364315d>1</sup></span><span class="rsb-email" data-v-1364315d>ljgao@ujs.edu.cn</span></span><span class="rsb-author" data-v-1364315d><span class="rsb-author-name" data-v-1364315d> Qirong Mao <sup data-v-1364315d>1</sup><sup class="rsb-tag" data-v-1364315d>†</sup></span><span class="rsb-email" data-v-1364315d>mao_qr@ujs.edu.cn</span></span><span class="rsb-author" data-v-1364315d><span class="rsb-author-name" data-v-1364315d> Ming Dong <sup data-v-1364315d>2</sup><sup class="rsb-tag" data-v-1364315d>†</sup></span><span class="rsb-email" data-v-1364315d>mdong@wayne.edu</span></span></p><ol class="rsb-affiliations" data-v-1364315d><li data-v-1364315d><sup data-v-1364315d>1</sup> Jiangsu University </li><li data-v-1364315d><sup data-v-1364315d>2</sup> Wayne State University </li></ol><p class="rsb-affiliation-note" data-v-1364315d><sup class="rsb-tag" data-v-1364315d>†</sup> Corresponding Author </p></header><nav class="rsb-nav rsb-fade rsb-delay-2" data-v-1364315d><span class="rsb-nav-title" data-v-1364315d>Quick Access</span><a class="rsb-nav-link rsb-nav-disabled" href="" aria-label="Paper link" aria-disabled="true" tabindex="-1" data-v-1364315d><span class="rsb-nav-icon rsb-nav-icon-demo" aria-hidden="true" data-v-1364315d></span> Paper </a><a class="rsb-nav-link" href="https://github.com/Yorch233/RSB/" aria-label="Github repository link" aria-disabled="true" tabindex="-1" data-v-1364315d><img class="rsb-nav-icon" src="https://github.githubassets.com/favicons/favicon.svg" alt="" data-v-1364315d> Github </a><a class="rsb-nav-link" href="https://huggingface.co/Yorch233/RSB/" aria-label="Hugging Face repository link" aria-disabled="true" tabindex="-1" data-v-1364315d><img class="rsb-nav-icon" src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" alt="" data-v-1364315d> Hugging Face </a><a class="rsb-nav-link rsb-nav-disabled" href="https://huggingface.co/spaces/Yorch233/RSB/" aria-label="Online demo link" aria-disabled="true" tabindex="-1" data-v-1364315d><img class="rsb-nav-icon" src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" alt="" data-v-1364315d> Online Demo </a></nav><section class="rsb-section rsb-fade rsb-delay-3" data-v-1364315d><h2 data-v-1364315d><span class="rsb-wave" aria-hidden="true" data-v-1364315d><span data-v-1364315d></span></span> Abstract </h2><div class="rsb-abstract-wrap" data-v-1364315d><p class="rsb-abstract" data-v-1364315d><span class="rsb-highlight" data-v-1364315d>Speech enhancement</span> (SE) requires high-fidelity reconstruction of clean speech that preserves linguistic and paralinguistic cues while maintaining high perceptual quality. Recently, <span class="rsb-highlight" data-v-1364315d>Schrödinger Bridge</span> (SB), a family of diffusion-based generative models, has advanced SE by bridging degraded and clean speech distributions in a principled formulation, enabling higher-quality reconstructions with fewer sampling steps. However, diffusion-based SE methods still face two challenges: <span class="rsb-issue" data-v-1364315d> (1) the fidelity-realism tradeoff, where they often prioritize perceptual realism encouraged by the learned speech prior, at the expense of fidelity; </span><span class="rsb-issue" data-v-1364315d> (2) the exposure bias issue, where iterative multi-step sampling causes early-step prediction errors to accumulate along the sampling trajectory and degrade enhanced speech quality. </span> In this paper, we analyze standard SB training and show that it induces a systematic prediction drift, which biases the multi-step trajectory and amplifies error accumulation. To address this, we propose <span class="rsb-highlight" data-v-1364315d>Regularized Schrödinger Bridge (RSB)</span> for high-fidelity SE, a generative approach that reconciles fidelity and realism while mitigating exposure bias. <span class="rsb-highlight" data-v-1364315d>RSB regularizes training with a Distortion-Perception Perturbation</span> that constructs time-varying targets by interpolating between clean speech and posterior-mean estimates, and trains the network on perturbed intermediate states to correct toward the ground truth progressively. Consequently, such perturbation simulates inference-time prediction errors, mitigating the training–inference mismatch and thereby reducing exposure bias. Furthermore, it also injects posterior-mean estimates as fidelity-preserving guidance, facilitating reconstruction fidelity. Experiments on the WSJ0 corpus and VoiceBank+DEMAND dataset demonstrate that RSB improves reconstruction fidelity over the advanced SE baselines, yielding a favorable fidelity-realism tradeoff and reducing exposure bias. </p><div class="rsb-legend" aria-hidden="true" data-v-1364315d><span class="rsb-legend-item" data-v-1364315d><span class="rsb-legend-swatch rsb-legend-swatch-highlight" data-v-1364315d></span> Key Concepts </span><span class="rsb-legend-item" data-v-1364315d><span class="rsb-legend-swatch rsb-legend-swatch-issue" data-v-1364315d></span> Issues </span></div></div></section><section class="rsb-section rsb-fade rsb-delay-4" data-v-1364315d><h2 data-v-1364315d><span class="rsb-wave" aria-hidden="true" data-v-1364315d><span data-v-1364315d></span></span> Keywords </h2><div class="rsb-meta" data-v-1364315d><span class="rsb-chip" data-v-1364315d>Speech enhancement</span><span class="rsb-chip" data-v-1364315d>Schrödinger bridge</span><span class="rsb-chip" data-v-1364315d>Diffusion models</span><span class="rsb-chip" data-v-1364315d>Distortion-perception tradeoff</span><span class="rsb-chip" data-v-1364315d>Exposure bias</span></div></section>',5)),s("section",_o,[S[4]||(S[4]=Ja('<h2 data-v-1364315d><span class="rsb-wave" aria-hidden="true" data-v-1364315d><span data-v-1364315d></span></span> Audio Samples </h2><p class="rsb-muted" data-v-1364315d> We publicly release <span class="rsb-accent" data-v-1364315d>10 samples</span> in total, drawn from two synthetic datasets: <span class="rsb-accent" data-v-1364315d>WSJ0+WHAM</span> is the denoising dataset and <span class="rsb-accent" data-v-1364315d>WSJ0+REVERB</span> is the dereverberation dataset. </p>',2)),s("div",po,[S[2]||(S[2]=s("h3",{class:"rsb-subtitle"},"WSJ0+WHAM (Denoising)",-1)),s("div",mo,[(p(!0),m(G,null,H(ee.value,(R,q)=>(p(),ra(Xa,{key:R,"sample-name":R,"sample-index":j.value?q+1:K.value+1,methods:C,"default-method":"Measurement"},null,8,["sample-name","sample-index"]))),128))]),s("div",ho,[s("button",{class:"rsb-nav-btn",type:"button",disabled:j.value,onClick:ce},"Previous",8,go),s("button",{class:"rsb-show-more",type:"button",onClick:S[0]||(S[0]=R=>j.value=!j.value)},y(j.value?"Hiden":"Show More"),1),s("button",{class:"rsb-nav-btn",type:"button",disabled:j.value,onClick:ue},"Next",8,fo)])]),s("div",bo,[S[3]||(S[3]=s("h3",{class:"rsb-subtitle"},"WSJ0+REVERB (Dereverberation)",-1)),s("div",wo,[(p(!0),m(G,null,H(ie.value,(R,q)=>(p(),ra(Xa,{key:R,"sample-name":R,"sample-index":T.value?q+1:g.value+1,methods:C,"default-method":"Measurement"},null,8,["sample-name","sample-index"]))),128))]),s("div",yo,[s("button",{class:"rsb-nav-btn",type:"button",disabled:T.value,onClick:de},"Previous",8,So),s("button",{class:"rsb-show-more",type:"button",onClick:S[1]||(S[1]=R=>T.value=!T.value)},y(T.value?"Hiden":"Show More"),1),s("button",{class:"rsb-nav-btn",type:"button",disabled:T.value,onClick:ae},"Next",8,Mo)])])])])]))}},ko=et(Ro,[["__scopeId","data-v-1364315d"]]);export{ko as default};
