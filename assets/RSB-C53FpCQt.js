import{_ as et,r as d,c as f,x as At,o as at,p as Za,w as te,b as p,d as m,e as s,t as S,s as I,F as H,f as j,i as E,n as T,g as ia,T as It,v as Ye,y as Me,z as Re,A as Ja}from"./index-DbaR0l8g.js";const Et="/logo/icon.png",zt="/assets/050a050v_c1_152_t60_1.57-DNo8cVUf.wav",Kt="/assets/051o020a_c1_454_snr_5.2-CdviCkkA.wav",Ft="/assets/051o020t_c1_473_snr_8.3-DXotndtl.wav",qt="/assets/053c010d_c1_896_snr_1.1-4ZRpcxme.wav",Wt="/assets/053c010k_c1_903_snr_-5.0-CWAvcMMp.wav",Gt="/assets/22gc0110_c1_1161_t60_1.72-HCn2IUO0.wav",Ht="/assets/420c020o_c1_1633_t60_1.19-CZZILkBS.wav",jt="/assets/421c0214_c2_1769_t60_1.86-BwLoPT-M.wav",Ot="/assets/421o0307_c1_1896_snr_8.7-C2vI2qWK.wav",Vt="/assets/422c020d_c2_1982_t60_1.68-DKIeiLVA.wav",Ut="/assets/050a050v_c1_152_t60_1.57-BpZyqh7B.wav",Yt="/assets/051o020a_c1_454_snr_5.2-BhY7mBGc.wav",Qt="/assets/051o020t_c1_473_snr_8.3-BTvvsHpL.wav",Zt="/assets/053c010d_c1_896_snr_1.1-DSqvW6dW.wav",Jt="/assets/053c010k_c1_903_snr_-5.0-BUFH6a9r.wav",Xt="/assets/22gc0110_c1_1161_t60_1.72-C4wu8c4P.wav",es="/assets/420c020o_c1_1633_t60_1.19-BpRbwu1-.wav",as="/assets/421c0214_c2_1769_t60_1.86-Q7z4cpcW.wav",ts="/assets/421o0307_c1_1896_snr_8.7-rsrNDu-g.wav",ss="/assets/422c020d_c2_1982_t60_1.68-BpjeU09r.wav",ns="/assets/050a050v_c1_152_t60_1.57-CvhZDAyo.wav",os="/assets/051o020a_c1_454_snr_5.2-DYetsLjT.wav",rs="/assets/051o020t_c1_473_snr_8.3-CwOK4UG4.wav",ls="/assets/053c010d_c1_896_snr_1.1-DpfHFcYn.wav",is="/assets/053c010k_c1_903_snr_-5.0-DiaqB7a6.wav",cs="/assets/22gc0110_c1_1161_t60_1.72-DEQ4-1E8.wav",us="/assets/420c020o_c1_1633_t60_1.19-Cl8HdOAU.wav",ds="/assets/421c0214_c2_1769_t60_1.86-Cbo1o95C.wav",vs="/assets/421o0307_c1_1896_snr_8.7-DklYkS7I.wav",_s="/assets/422c020d_c2_1982_t60_1.68-65bJ9H90.wav",fs="/assets/050a050v_c1_152_t60_1.57-DqXrYtBJ.wav",ps="/assets/051o020a_c1_454_snr_5.2-CWhTvTAa.wav",ms="/assets/051o020t_c1_473_snr_8.3-qM_ibCXt.wav",hs="/assets/053c010d_c1_896_snr_1.1-BBcDxnp-.wav",gs="/assets/053c010k_c1_903_snr_-5.0-UQKnp7wS.wav",bs="/assets/22gc0110_c1_1161_t60_1.72-DjmWrned.wav",ws="/assets/420c020o_c1_1633_t60_1.19-DplED0NS.wav",ys="/assets/421c0214_c2_1769_t60_1.86-BKkjs79k.wav",Ss="/assets/421o0307_c1_1896_snr_8.7-CtAulGKl.wav",Ms="/assets/422c020d_c2_1982_t60_1.68-D95Z-yxq.wav",Rs="/assets/050a050v_c1_152_t60_1.57-BfOoGZjy.wav",Bs="/assets/051o020a_c1_454_snr_5.2-C4Y0qzGO.wav",xs="/assets/051o020t_c1_473_snr_8.3-Cv07XJiA.wav",ks="/assets/053c010d_c1_896_snr_1.1-CWrNQ9FV.wav",Cs="/assets/053c010k_c1_903_snr_-5.0-BP4JaKOh.wav",$s="/assets/22gc0110_c1_1161_t60_1.72-CcNyNj2z.wav",Ns="/assets/420c020o_c1_1633_t60_1.19-D7_rvMiY.wav",Ts="/assets/421c0214_c2_1769_t60_1.86-D6bCPskW.wav",Ls="/assets/421o0307_c1_1896_snr_8.7-D8ttMFfp.wav",Ds="/assets/422c020d_c2_1982_t60_1.68-BfRh0UNf.wav",Ps="/assets/050a050v_c1_152_t60_1.57-BDj51lym.wav",As="/assets/051o020a_c1_454_snr_5.2-C_wnR76_.wav",Is="/assets/051o020t_c1_473_snr_8.3-D9lIPD4L.wav",Es="/assets/053c010d_c1_896_snr_1.1-BPNjN9ef.wav",zs="/assets/053c010k_c1_903_snr_-5.0-C1Hf_kB-.wav",Ks="/assets/22gc0110_c1_1161_t60_1.72-CgmK3u29.wav",Fs="/assets/420c020o_c1_1633_t60_1.19-DcQrH1YJ.wav",qs="/assets/421c0214_c2_1769_t60_1.86-CB09amZ6.wav",Ws="/assets/421o0307_c1_1896_snr_8.7-D3VPf2Qg.wav",Gs="/assets/422c020d_c2_1982_t60_1.68-D4yo4deO.wav",Hs={class:"wave-header"},js={class:"wave-description"},Os={class:"wave-desc-item"},Vs={key:0,class:"wave-desc-index"},Us={class:"wave-desc-item"},Ys={class:"wave-desc-value"},Qs={class:"wave-desc-item wave-desc-tooltip"},Zs={class:"wave-desc-label"},Js={class:"wave-desc-value"},Xs={key:0,class:"wave-desc-tip"},en={class:"method-list"},an={class:"method-group method-group-primary"},tn=["onMouseenter"],sn=["disabled","onClick"],nn={class:"chip-label"},on={key:0,class:"chip-spinner","aria-hidden":"true"},rn={key:1,class:"chip-action","aria-hidden":"true"},ln=["src"],cn={key:0,class:"method-group method-group-secondary"},un={class:"method-group-scroll"},dn=["onMouseenter"],vn=["disabled","onClick"],_n={class:"chip-label"},fn={key:0,class:"chip-spinner","aria-hidden":"true"},pn={key:1,class:"chip-action","aria-hidden":"true"},mn=["src"],hn={class:"wave-panel"},gn={class:"wave-panel-header"},bn={class:"wave-panel-title"},wn={class:"wave-panel-actions"},yn={class:"view-toggle",role:"group","aria-label":"Visualization mode"},Sn={class:"wave-canvas-wrap","aria-hidden":"true"},Mn={key:0,class:"canvas-loading wave-loading"},Rn={class:"wave-time-axis","aria-hidden":"true"},Bn={class:"time-axis-track"},xn={class:"time-axis-label"},kn={class:"time-axis-caret-label"},Cn={class:"spectrogram-block","aria-hidden":"true"},$n={class:"spectrogram-labels"},Nn={class:"spectrogram-label"},Tn={class:"spectrogram-label"},Ln={class:"spectrogram-row"},Dn={class:"spectrogram-axis spectrogram-axis-y"},Pn={class:"spectrogram-axis-label"},An={class:"spectrogram-axis spectrogram-axis-x"},In={class:"spectrogram-axis-label"},En={key:0,class:"canvas-loading spectrogram-loading"},zn={class:"spectrogram-axis spectrogram-axis-y"},Kn={class:"spectrogram-axis-label"},Fn={class:"spectrogram-axis spectrogram-axis-x"},qn={class:"spectrogram-axis-label"},Wn={key:0,class:"spectrogram-placeholder"},Gn={key:1,class:"canvas-loading spectrogram-loading"},Hn={class:"spectrogram-controls","aria-hidden":"true"},jn={class:"spectrogram-quality"},On={class:"spectrogram-quality-options",role:"group","aria-label":"Spectrogram quality"},Vn=["onClick"],Un={class:"progress-row"},Yn=["aria-label"],Qn=["src","alt"],Zn={class:"time-label"},Jn=["value"],Xn={class:"time-label"},eo={class:"volume-control"},ao=["aria-label"],to=["src","alt"],so={class:"volume-popover"},no={class:"volume-label"},oo={class:"volume-slider-wrap"},ro=["value"],lo=["src"],io=40,co={__name:"AudioWaveCompare",props:{sampleName:{type:String,required:!0},sampleIndex:{type:Number,default:null},methods:{type:Array,default:()=>[]},defaultMethod:{type:String,default:"Measurement"},cleanKey:{type:String,default:"Ground_Truth"},measurementKey:{type:String,default:"Measurement"}},setup(ca){var Ua;const k=d(100),c=ca,O=[{key:"Ground_Truth",label:"Ground Truth (Clean)"},{key:"Measurement",label:"Measurement (Noisy/Reverb)"},{key:"NCSN+M",label:"NCSN+M"},{key:"SB",label:"SB"},{key:"StoRM",label:"StoRM"},{key:"RSB",label:"RSB (Ours)"}],L=f(()=>{var e;return(e=c.methods)!=null&&e.length?c.methods:O}),F=f(()=>{const e=[...L.value],a=e.find(r=>r.key===c.measurementKey),t=e.find(r=>r.key===c.cleanKey),n=e.filter(r=>r.key!==c.measurementKey&&r.key!==c.cleanKey);return[a,...n,t].filter(Boolean)}),b=d(c.defaultMethod),se=d(null),de=d(null),ve=d(null),_e=d(null),fe=d(null),ne=d(null),C=d(null),X=d(null),D=d(null),$=d(null),ee=d(1),h=d(0),i=d(0),M=d(!1),V=d(0),Ee=d(!1),ua=d(0),pe=d(null),me=d(null),ze=d(!1),Qe=d(!1),N=d("waveform"),U=d(!1),Y=d(!1),Q=d(!1),Ze=d({x:0,y:0}),ae=d(!1),da=d(!0),va=d(!0),Be=d(""),xe=d(""),q=d(!1),he=d(""),Ke=d({}),tt=f(()=>ke(c.cleanKey)),Fe=f(()=>ke(b.value)),st=f(()=>ke(c.measurementKey));f(()=>{var e;return((e=L.value.find(a=>a.key===c.cleanKey))==null?void 0:e.label)||"Ground Truth"});const _a=f(()=>{var e;return((e=L.value.find(a=>a.key===b.value))==null?void 0:e.label)||b.value}),fa=f(()=>{var e;return((e=L.value.find(a=>a.key===c.measurementKey))==null?void 0:e.label)||"Measurement"}),P=f(()=>b.value!==c.measurementKey),qe=f(()=>ta[c.measurementKey]||"#ef4444"),We=f(()=>ta[b.value]||"#0a84ff"),Je=f(()=>i.value?h.value/i.value*100:0),nt=f(()=>({background:`linear-gradient(90deg, #0a84ff 0%, #0a84ff ${Je.value}%, #e2e8f0 ${Je.value}%, #e2e8f0 100%)`})),ot=f(()=>Math.max(0,i.value-h.value)),rt=f(()=>ce(V.value)),lt=f(()=>i.value?h.value/i.value*100:0),ge=f(()=>{if(!i.value||i.value<=0)return[];const e=[];for(let a=0;a<=Math.floor(i.value);a+=1)e.push(a);return e}),it=f(()=>ge.value.length?ge.value[ge.value.length-1]:0),pa=f(()=>[0,2,4,6,8]),ct=f(()=>M.value?"/logo/reload.svg":q.value?"/logo/player-pause.svg":"/logo/player-play.svg"),ma=f(()=>M.value?"Replay":q.value?"Pause":"Play"),ut=f(()=>c.sampleName),ha=f(()=>Number.isFinite(c.sampleIndex)&&c.sampleIndex>0?`#${c.sampleIndex}`:""),Ge=f(()=>{const e=c.sampleName.match(/snr=([\-\d]+(?:\.\d+)?)/i);if(e)return{label:"SNR",value:`${e[1]} dB`,tooltip:"Signal-to-noise ratio (SNR) measures speech strength relative to background noise. Higher is cleaner."};const a=c.sampleName.match(/t60=([\-\d]+(?:\.\d+)?)/i);return a?{label:"T60",value:`${a[1]} s`,tooltip:"Reverberation time (T60) is the time for sound to decay by 60 dB. Lower means less reverberation."}:{label:"Metric",value:"—",tooltip:""}}),ga=f(()=>Math.round(k.value)),dt=f(()=>k.value<=0?"/logo/volume-off.svg":k.value<100?"/logo/volume-2.svg":"/logo/volume.svg"),ba=f(()=>k.value<=0?"Mute":"Volume"),oe=f(()=>me.value??pe.value),vt=f(()=>oe.value==="compare"?.1:1),_t=f(()=>oe.value==="measurement"?.1:1),Xe=f(()=>{const e=P.value?.45:1;return oe.value==="compare"?.1:me.value==="measurement"?1:e}),ea=f(()=>oe.value==="measurement"?.1:.9),wa=f(()=>Be.value||xe.value?Be.value||xe.value:""),ya=f(()=>U.value||Y.value),re={instance:null,decodeContext:null},He=new Map,z=new Map,le=d(1),aa=f(()=>({1:1,2:1.6,3:2.2,4:3,5:4})[le.value]??2.2),je=(Ua=At())==null?void 0:Ua.appContext.config.globalProperties.$messageBox,ft=async e=>{if(e!==le.value){if(!(je!=null&&je.confirm)){le.value=e;return}try{await je.confirm({title:"Spectrogram Quality",message:'Notice: Higher quality means longer rendering time. <span style="color:#ef4444;font-weight:600;">It may even cause the browser to crash. Please save any unsaved work in other tabs first.</span>',closeOnClickOverlay:!0}),le.value=e}catch{}}},ta={Measurement:"#ff9d00",Ground_Truth:"#3b82f6","NCSN+M":"#22c55e","NCSN++M":"#22c55e",SB:"#a855f7",StoRM:"#14b8a6",RSB:"#f97316"},pt={Measurement:"Measurement is the degraded speech corrupted by noise and reverberation.",Ground_Truth:"Ground Truth is the original clean speech.","NCSN++M":"NCSN++M is a common backbone of diffusion models used here as a purely predictive method, trained with an MSE loss to predict clean speech.",SB:"SB models the transport between noisy and clean speech directly via Schrödinger Bridge. It is our baseline method.",StoRM:"StoRM is a hybrid method that cascades a predictive model with a diffusion model. The diffusion model refines details from the initial predictive estimate.",RSB:"RSB is the proposed method in this paper."},Z=(e,a)=>{Ke.value={...Ke.value,[e]:a}},ie=e=>Ke.value[e]==="ready",ke=e=>new URL(Object.assign({"../assets/RSB/audio/Ground_Truth/050a050v_c1_152_t60=1.57.wav":zt,"../assets/RSB/audio/Ground_Truth/051o020a_c1_454_snr=5.2.wav":Kt,"../assets/RSB/audio/Ground_Truth/051o020t_c1_473_snr=8.3.wav":Ft,"../assets/RSB/audio/Ground_Truth/053c010d_c1_896_snr=1.1.wav":qt,"../assets/RSB/audio/Ground_Truth/053c010k_c1_903_snr=-5.0.wav":Wt,"../assets/RSB/audio/Ground_Truth/22gc0110_c1_1161_t60=1.72.wav":Gt,"../assets/RSB/audio/Ground_Truth/420c020o_c1_1633_t60=1.19.wav":Ht,"../assets/RSB/audio/Ground_Truth/421c0214_c2_1769_t60=1.86.wav":jt,"../assets/RSB/audio/Ground_Truth/421o0307_c1_1896_snr=8.7.wav":Ot,"../assets/RSB/audio/Ground_Truth/422c020d_c2_1982_t60=1.68.wav":Vt,"../assets/RSB/audio/Measurement/050a050v_c1_152_t60=1.57.wav":Ut,"../assets/RSB/audio/Measurement/051o020a_c1_454_snr=5.2.wav":Yt,"../assets/RSB/audio/Measurement/051o020t_c1_473_snr=8.3.wav":Qt,"../assets/RSB/audio/Measurement/053c010d_c1_896_snr=1.1.wav":Zt,"../assets/RSB/audio/Measurement/053c010k_c1_903_snr=-5.0.wav":Jt,"../assets/RSB/audio/Measurement/22gc0110_c1_1161_t60=1.72.wav":Xt,"../assets/RSB/audio/Measurement/420c020o_c1_1633_t60=1.19.wav":es,"../assets/RSB/audio/Measurement/421c0214_c2_1769_t60=1.86.wav":as,"../assets/RSB/audio/Measurement/421o0307_c1_1896_snr=8.7.wav":ts,"../assets/RSB/audio/Measurement/422c020d_c2_1982_t60=1.68.wav":ss,"../assets/RSB/audio/NCSN++M/050a050v_c1_152_t60=1.57.wav":ns,"../assets/RSB/audio/NCSN++M/051o020a_c1_454_snr=5.2.wav":os,"../assets/RSB/audio/NCSN++M/051o020t_c1_473_snr=8.3.wav":rs,"../assets/RSB/audio/NCSN++M/053c010d_c1_896_snr=1.1.wav":ls,"../assets/RSB/audio/NCSN++M/053c010k_c1_903_snr=-5.0.wav":is,"../assets/RSB/audio/NCSN++M/22gc0110_c1_1161_t60=1.72.wav":cs,"../assets/RSB/audio/NCSN++M/420c020o_c1_1633_t60=1.19.wav":us,"../assets/RSB/audio/NCSN++M/421c0214_c2_1769_t60=1.86.wav":ds,"../assets/RSB/audio/NCSN++M/421o0307_c1_1896_snr=8.7.wav":vs,"../assets/RSB/audio/NCSN++M/422c020d_c2_1982_t60=1.68.wav":_s,"../assets/RSB/audio/RSB/050a050v_c1_152_t60=1.57.wav":fs,"../assets/RSB/audio/RSB/051o020a_c1_454_snr=5.2.wav":ps,"../assets/RSB/audio/RSB/051o020t_c1_473_snr=8.3.wav":ms,"../assets/RSB/audio/RSB/053c010d_c1_896_snr=1.1.wav":hs,"../assets/RSB/audio/RSB/053c010k_c1_903_snr=-5.0.wav":gs,"../assets/RSB/audio/RSB/22gc0110_c1_1161_t60=1.72.wav":bs,"../assets/RSB/audio/RSB/420c020o_c1_1633_t60=1.19.wav":ws,"../assets/RSB/audio/RSB/421c0214_c2_1769_t60=1.86.wav":ys,"../assets/RSB/audio/RSB/421o0307_c1_1896_snr=8.7.wav":Ss,"../assets/RSB/audio/RSB/422c020d_c2_1982_t60=1.68.wav":Ms,"../assets/RSB/audio/SB/050a050v_c1_152_t60=1.57.wav":Rs,"../assets/RSB/audio/SB/051o020a_c1_454_snr=5.2.wav":Bs,"../assets/RSB/audio/SB/051o020t_c1_473_snr=8.3.wav":xs,"../assets/RSB/audio/SB/053c010d_c1_896_snr=1.1.wav":ks,"../assets/RSB/audio/SB/053c010k_c1_903_snr=-5.0.wav":Cs,"../assets/RSB/audio/SB/22gc0110_c1_1161_t60=1.72.wav":$s,"../assets/RSB/audio/SB/420c020o_c1_1633_t60=1.19.wav":Ns,"../assets/RSB/audio/SB/421c0214_c2_1769_t60=1.86.wav":Ts,"../assets/RSB/audio/SB/421o0307_c1_1896_snr=8.7.wav":Ls,"../assets/RSB/audio/SB/422c020d_c2_1982_t60=1.68.wav":Ds,"../assets/RSB/audio/StoRM/050a050v_c1_152_t60=1.57.wav":Ps,"../assets/RSB/audio/StoRM/051o020a_c1_454_snr=5.2.wav":As,"../assets/RSB/audio/StoRM/051o020t_c1_473_snr=8.3.wav":Is,"../assets/RSB/audio/StoRM/053c010d_c1_896_snr=1.1.wav":Es,"../assets/RSB/audio/StoRM/053c010k_c1_903_snr=-5.0.wav":zs,"../assets/RSB/audio/StoRM/22gc0110_c1_1161_t60=1.72.wav":Ks,"../assets/RSB/audio/StoRM/420c020o_c1_1633_t60=1.19.wav":Fs,"../assets/RSB/audio/StoRM/421c0214_c2_1769_t60=1.86.wav":qs,"../assets/RSB/audio/StoRM/421o0307_c1_1896_snr=8.7.wav":Ws,"../assets/RSB/audio/StoRM/422c020d_c2_1982_t60=1.68.wav":Gs})[`../assets/RSB/audio/${e}/${c.sampleName}`],import.meta.url).href,Ce=()=>{if(!re.instance){const e=window.AudioContext||window.webkitAudioContext;re.instance=new e}return re.instance},mt=()=>{if(!re.decodeContext){const e=window.OfflineAudioContext||window.webkitOfflineAudioContext;e?re.decodeContext=new e(1,1,44100):re.decodeContext=Ce()}return re.decodeContext},Oe=async e=>{if(He.has(e))return He.get(e);const a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch audio: ${a.status}`);const t=await a.arrayBuffer(),n=mt();try{const r=await n.decodeAudioData(t.slice(0));return He.set(e,r),r}catch{const o=Ce();if(o.state==="suspended")try{await o.resume()}catch{}const l=await o.decodeAudioData(t.slice(0));return He.set(e,l),l}},Sa=e=>{const a=e.getChannelData(0);let t=0;for(let n=0;n<a.length;n+=1){const r=Math.abs(a[n]);r>t&&(t=r)}return t===0?1:.95/t},ht=()=>{var e,a,t,n,r,o,l,v,u;return b.value===c.measurementKey?((e=$.value)==null?void 0:e.duration)??((a=D.value)==null?void 0:a.duration)??((t=X.value)==null?void 0:t.duration)??0:b.value===c.cleanKey?((n=X.value)==null?void 0:n.duration)??((r=D.value)==null?void 0:r.duration)??((o=$.value)==null?void 0:o.duration)??0:((l=D.value)==null?void 0:l.duration)??((v=$.value)==null?void 0:v.duration)??((u=X.value)==null?void 0:u.duration)??0},Ma=(e,a,t,n,r={})=>{if(!e||!a)return;const{color:o="#2563eb",alpha:l=1,scale:v=1}=r,u=a.getChannelData(0),_=Math.max(1,Math.floor(u.length/t)),w=n/2;e.strokeStyle=o,e.globalAlpha=l,e.lineWidth=1,e.beginPath();for(let R=0;R<t;R+=1){const y=R*_;let B=1,g=-1;for(let x=0;x<_;x+=1){const G=u[y+x]??0;G<B&&(B=G),G>g&&(g=G)}const K=Math.max(-1,Math.min(1,B*v)),A=Math.max(-1,Math.min(1,g*v));e.moveTo(R,(1+K)*w),e.lineTo(R,(1+A)*w)}e.stroke(),e.globalAlpha=1},Ra=e=>e.join("|"),sa=(e,a)=>{z.size>=io&&z.clear(),z.set(e,a)},Ba=e=>{const a=e.replace("#","");if(a.length!==6)return{r:15,g:23,b:42};const t=Number.parseInt(a,16);return{r:t>>16&255,g:t>>8&255,b:t&255}},xa=(e,a,t)=>{const n=Ba(e),r=Ba(a),o=Math.min(1,Math.max(0,t)),l=Math.round(n.r+(r.r-n.r)*o),v=Math.round(n.g+(r.g-n.g)*o),u=Math.round(n.b+(r.b-n.b)*o);return`rgb(${l}, ${v}, ${u})`},ka=(e,a,t,n,r,o,l)=>{const v=()=>{if(!$.value)return;e.save(),e.beginPath(),e.rect(0,r,n,o),e.clip(),e.save(),e.translate(0,r);const _=l==="muted"?xa(qe.value,"#f8fafc",.65):qe.value;Ma(e,$.value,n,o,{color:_,alpha:Xe.value,scale:ee.value}),e.restore(),e.restore()},u=()=>{if(!D.value||!P.value)return;e.save(),e.beginPath(),e.rect(0,r,n,o),e.clip(),e.save(),e.translate(0,r);const _=l==="muted"?xa(We.value,"#f8fafc",.65):We.value;Ma(e,D.value,n,o,{color:_,alpha:ea.value,scale:ee.value}),e.restore(),e.restore()};oe.value==="measurement"?(u(),v()):(oe.value,v(),u())},Ca=(e,a,t,n,r,o)=>{const l=r+o/2,v=o/2;[1,.5,0,-.5,-1].forEach(_=>{const w=l-_*v;e.beginPath(),e.lineWidth=_===0?1.4:1,e.strokeStyle=_===0?"rgba(148, 163, 184, 0.55)":"rgba(148, 163, 184, 0.25)",e.moveTo(0,w),e.lineTo(n,w),e.stroke()})},$a=(e,a,t,n,r)=>{const o=n+r/2,l=r/2,v=[1,.5,0,-.5,-1],u=a-6;e.font='10px "Times New Roman", serif',e.textAlign="right",e.textBaseline="middle",e.fillStyle="rgba(100, 116, 139, 0.9)",v.forEach(_=>{const w=o-_*l;e.fillText(_.toFixed(1),u,w)})},Na=(e,a,t,n)=>{if(!Number.isFinite(n))return;const r=q.value?.6+.4*Math.sin(performance.now()*.008):1;e.beginPath(),e.lineWidth=ae.value?2.6:1.3,e.strokeStyle=`rgba(148, 163, 184, ${.8*r})`,e.moveTo(n,0),e.lineTo(n,t),e.stroke()},W=()=>{if(N.value==="spectrogram"){Y.value=!0,Da(),U.value=!1;return}const e=de.value;if(!e){U.value=!1;return}const a=e.getBoundingClientRect(),t=a.height||110,n=a.width||480,r=window.devicePixelRatio||1;e.width=n*r,e.height=t*r;const o=e.getContext("2d");if(!o){U.value=!1;return}const l=Ra(["waveform",c.sampleName,b.value,oe.value??"none",P.value?"1":"0",$.value?"m1":"m0",D.value?"c1":"c0",ee.value,qe.value,We.value,Xe.value,ea.value,n,t,r]),v=`${l}|normal`,u=`${l}|muted`,_=z.get(v),w=z.get(u);o.setTransform(r,0,0,r,0,0),o.clearRect(0,0,n,t);const R=28,y=10,B=10,g=Math.max(0,n-R),K=Math.max(0,t-y-B),A=i.value?h.value/i.value*g:0;if(_&&w){U.value=!1,Ca(o,n,t,g,y,K),o.save(),o.globalAlpha=1,o.beginPath(),o.rect(0,0,Math.max(0,Math.min(g,A)),t),o.clip(),o.drawImage(_,0,0,n,t),o.restore(),o.save(),o.beginPath(),o.rect(Math.max(0,Math.min(g,A)),0,g,t),o.clip(),o.drawImage(w,0,0,n,t),o.restore(),$a(o,n,t,y,K),Na(o,g,t,A),e.style.opacity="1";return}e.style.opacity="0",U.value=!0;const x=document.createElement("canvas");x.width=n*r,x.height=t*r;const G=x.getContext("2d");if(!G){U.value=!1;return}G.setTransform(r,0,0,r,0,0),ka(G,n,t,g,y,K,"normal"),sa(v,x);const ue=document.createElement("canvas");ue.width=n*r,ue.height=t*r;const ye=ue.getContext("2d");ye&&(ye.setTransform(r,0,0,r,0,0),ka(ye,n,t,g,y,K,"muted"),sa(u,ue)),Ca(o,n,t,g,y,K),o.save(),o.globalAlpha=1,o.beginPath(),o.rect(0,0,Math.max(0,Math.min(g,A)),t),o.clip(),o.drawImage(x,0,0,n,t),o.restore(),o.save(),o.beginPath(),o.rect(Math.max(0,Math.min(g,A)),0,g,t),o.clip(),o.drawImage(ue,0,0,n,t),o.restore(),$a(o,n,t,y,K),Na(o,g,t,A),requestAnimationFrame(()=>{e.style.opacity="1",U.value=!1})},$e=[[0,0,0,4],[.1,25,6,64],[.2,53,11,99],[.3,84,21,117],[.4,113,31,126],[.5,142,41,122],[.6,170,54,99],[.7,198,72,70],[.8,225,101,40],[.9,246,136,22],[1,252,181,20]],gt=()=>{switch(le.value){case 1:return{fftSize:512,hopLength:256};case 2:return{fftSize:512,hopLength:128};case 3:return{fftSize:1024,hopLength:128};case 4:return{fftSize:1024,hopLength:64};case 5:return{fftSize:2048,hopLength:64};default:return{fftSize:1024,hopLength:128}}},bt=e=>{const a=Math.min(1,Math.max(0,e));for(let n=0;n<$e.length-1;n+=1){const[r,o,l,v]=$e[n],[u,_,w,R]=$e[n+1];if(a>=r&&a<=u){const y=(a-r)/(u-r);return{r:Math.round(o+(_-o)*y),g:Math.round(l+(w-l)*y),b:Math.round(v+(R-v)*y)}}}const t=$e[$e.length-1];return{r:t[1],g:t[2],b:t[3]}},wt=(e,a,t,n,r)=>{const o=a.getChannelData(0),{fftSize:l,hopLength:v}=gt(),u=l/2,_=Math.max(1,Math.floor((o.length-l)/v)+1),w=new Float32Array(l);for(let x=0;x<l;x+=1)w[x]=.5-.5*Math.cos(2*Math.PI*x/(l-1));const R=-60,y=0,B=1e-10,g=a.sampleRate/2,A=Math.min(u,Math.max(8,Math.floor(1e4/g*u)));for(let x=0;x<t;x+=1){const G=Math.min(_-1,Math.floor(x/t*_)),ue=Math.min(G*v,Math.max(0,o.length-l)),ye=new Float32Array(u);for(let J=0;J<u;J+=1){let Pe=0,Se=0;for(let Ie=0;Ie<l;Ie+=1){const Ya=(o[ue+Ie]||0)*w[Ie],Qa=2*Math.PI*J*Ie/l;Pe+=Ya*Math.cos(Qa),Se-=Ya*Math.sin(Qa)}const Ae=Math.sqrt(Pe*Pe+Se*Se),Pt=20*Math.log10(.1*Ae+B);ye[J]=Math.min(1,Math.max(0,(Pt-R)/(y-R)))}for(let J=0;J<n;J+=1){const Pe=Math.floor(J/n*A),Se=ye[Pe]||0;if(Se<=0)continue;const Ae=bt(Se);e.fillStyle=`rgb(${Ae.r}, ${Ae.g}, ${Ae.b})`,e.fillRect(x,n-J-1,1,1)}}},Ve=(e,a,t,n)=>{if(!e||!a)return;const r=e.getBoundingClientRect(),o=r.height||110,l=r.width||240,v=(window.devicePixelRatio||1)*aa.value,u=Math.max(1,Math.floor(l*v)),_=Math.max(1,Math.floor(o*v)),w=`${t}|${l}|${o}|${v}`;e.width=u,e.height=_;const R=e.getContext("2d");if(!R)return;const y=z.get(w);if(R.setTransform(1,0,0,1,0,0),R.clearRect(0,0,u,_),y){R.drawImage(y,0,0,u,_);return}const B=document.createElement("canvas");B.width=u,B.height=_;const g=B.getContext("2d");g&&(g.setTransform(1,0,0,1,0,0),g.clearRect(0,0,u,_),g.fillStyle="#0b0f16",g.fillRect(0,0,u,_),wt(g,a,u,_),sa(w,B),R.drawImage(B,0,0,u,_))},Ta=(e,a)=>{if(!e||!a||!Q.value)return;const t=e.getBoundingClientRect(),n=t.width||0,r=t.height||0;if(!n||!r)return;const o=window.devicePixelRatio||1;a.width=n*o,a.height=r*o;const l=a.getContext("2d");if(!l)return;l.setTransform(o,0,0,o,0,0),l.clearRect(0,0,n,r);const v=2.2,u=140,_=90,w=Math.min(1,Math.max(0,Ze.value.x)),R=Math.min(1,Math.max(0,Ze.value.y));let y=w*n-u/2,B=R*r-_/2;y=Math.min(Math.max(0,y),n-u),B=Math.min(Math.max(0,B),r-_);const g=y*(e.width/n),K=B*(e.height/r),A=u/v*(e.width/n),x=_/v*(e.height/r);l.imageSmoothingEnabled=!0,l.drawImage(e,g,K,A,x,y,B,u,_),l.lineWidth=1.5,l.strokeStyle="rgba(255, 255, 255, 0.9)",l.strokeRect(y+.5,B+.5,u-1,_-1)},Ne=e=>{if(!e)return;const a=e.getBoundingClientRect(),t=a.width||0,n=a.height||0,r=window.devicePixelRatio||1;e.width=t*r,e.height=n*r;const o=e.getContext("2d");o&&(o.setTransform(r,0,0,r,0,0),o.clearRect(0,0,t,n))},La=()=>{Ta(ve.value,fe.value),P.value?Ta(_e.value,ne.value):Ne(ne.value)},Ue=e=>{if(!e)return;const a=e.getBoundingClientRect(),t=a.height||110,n=a.width||240,r=(window.devicePixelRatio||1)*aa.value,o=Math.max(1,Math.floor(n*r)),l=Math.max(1,Math.floor(t*r));e.width=o,e.height=l;const v=e.getContext("2d");v&&(v.setTransform(1,0,0,1,0,0),v.clearRect(0,0,o,l),v.fillStyle="#0b0f16",v.fillRect(0,0,o,l))},Da=()=>{const e=ve.value,a=_e.value;if(!e||!a){Y.value=!1;return}const t=Ra(["spectrogram",c.sampleName,b.value,Xe.value,ea.value]),n=(u,_)=>{const w=u.getBoundingClientRect(),R=w.height||110,y=w.width||240,B=(window.devicePixelRatio||1)*aa.value;return`${t}${_}|${y}|${R}|${B}`},r=n(e,"|left"),o=n(a,"|right"),l=z.has(r),v=!P.value||z.has(o);if(l&&v){Ve(e,$.value,`${t}|left`),D.value&&P.value?Ve(a,D.value,`${t}|right`):Ue(a),Y.value=!1;return}Y.value=!0,Ue(e),Ue(a),requestAnimationFrame(()=>{window.setTimeout(()=>{$.value&&Ve(e,$.value,`${t}|left`),D.value&&P.value?Ve(a,D.value,`${t}|right`):Ue(a),requestAnimationFrame(()=>{Y.value=!1,Q.value&&La()})},0)})},yt=async()=>{try{const e=await Oe(st.value);$.value=e,ee.value=Sa(e),Z(c.measurementKey,"ready"),W()}catch{$.value=null,ee.value=1,Z(c.measurementKey,"error")}},St=async()=>{da.value=!0,Be.value="";try{const e=await Oe(tt.value);X.value=e,Z(c.cleanKey,"ready"),W()}catch{Be.value="Load failed",Z(c.cleanKey,"error")}finally{da.value=!1}},Pa=async()=>{va.value=!0,xe.value="";try{const e=await Oe(Fe.value);D.value=e,Z(b.value,"ready"),b.value===c.measurementKey&&!$.value&&($.value=e,ee.value=Sa(e)),(!Number.isFinite(i.value)||i.value<=0)&&(i.value=e.duration||0),W()}catch{xe.value="Load failed",Z(b.value,"error")}finally{va.value=!1}},Mt=()=>{W()},Rt=async e=>{const a=C.value;if(!a||!ie(e))return;Ga();const t=Ce();if(t.state==="suspended")try{await t.resume()}catch{}const n=ke(e);if(he.value===e&&!a.paused){a.pause();return}a.src!==n&&(a.src=n);try{await a.play(),he.value=e}catch{}},Aa=e=>{ie(e)&&(b.value=e,Rt(e))},Bt=()=>{const e=C.value;if(!e||!ie(b.value))return;Ga();const a=Ce();a.state==="suspended"&&a.resume().catch(()=>{}),e.src!==Fe.value&&(e.src=Fe.value),M.value&&(e.currentTime=0),e.paused?e.play():e.pause()},xt=e=>e===c.measurementKey?"measurement":e===c.cleanKey?"ground-truth":"method",kt=f(()=>F.value.filter(e=>e.key===c.measurementKey||e.key===c.cleanKey)),Ia=f(()=>F.value.filter(e=>e.key!==c.measurementKey&&e.key!==c.cleanKey)),Ea=e=>({"--method-color":ta[e]||"#94a3b8"}),za=e=>q.value&&he.value===e?"/logo/player-pause.svg":"/logo/player-play.svg",be=d({text:"",x:0,y:0,visible:!1});let na=0;const Ka=(e,a)=>{const t=pt[a];if(!t)return;window.clearTimeout(na);const n=e.currentTarget.getBoundingClientRect();na=window.setTimeout(()=>{be.value={text:t,x:n.left,y:n.bottom+10,visible:!0}},1e3)},Fa=()=>{window.clearTimeout(na),be.value={text:"",x:0,y:0,visible:!1}},qa=e=>{if(me.value){me.value=null;return}me.value=e};let oa=null,we=null;const Wa=e=>{const a=C.value;if(!a)return;const t=Math.min(2,Math.max(0,e/100));if(we){we.gain.value=t;return}a.volume=Math.min(1,t)},Ga=()=>{const e=C.value;if(!e||oa)return;const a=Ce();oa=a.createMediaElementSource(e),we=a.createGain(),we.gain.value=Math.min(2,Math.max(0,k.value/100)),oa.connect(we),we.connect(a.destination),e.volume=1},Ct=e=>{const a=Number(e.target.value);Number.isFinite(a)&&(k.value=Math.min(200,Math.max(0,a)))},$t=()=>{F.value.forEach(e=>{if(!(e!=null&&e.key))return;Z(e.key,"loading");const a=ke(e.key);Oe(a).then(()=>{Z(e.key,"ready")}).catch(()=>{Z(e.key,"error")})})},Nt=e=>{const a=C.value;if(!a||!i.value)return;const t=Number(e.target.value);a.currentTime=t/100*i.value},Tt=e=>{if(!C.value||!i.value)return;const t=e.currentTarget.getBoundingClientRect(),n=Math.min(Math.max(0,e.clientX-t.left),t.width),r=t.width?n/t.width:0;V.value=r*i.value,ua.value=n,Ee.value=!0},Lt=()=>{Ee.value=!1},Ha=(e,a)=>{if(N.value!=="spectrogram")return;const t=a==="right"?_e.value:ve.value;if(!t)return;const n=t.getBoundingClientRect(),r=Math.min(Math.max(0,e.clientX-n.left),n.width),o=Math.min(Math.max(0,e.clientY-n.top),n.height);Ze.value={x:n.width?r/n.width:0,y:n.height?o/n.height:0},Q.value=!0,La()},ja=()=>{Q.value=!1,Ne(fe.value),Ne(ne.value)},ce=(e,a=!1)=>{if(!Number.isFinite(e))return"00:00";const t=Math.floor(e/60),n=Math.floor(e%60);if(!a)return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}`;const r=Math.floor((e-Math.floor(e))*1e3);return`${String(t).padStart(2,"0")}:${String(n).padStart(2,"0")}.${String(r).padStart(3,"0")}`};let Te=0,Oa=0;const ra=()=>{const e=C.value;if(!e)return;const a=performance.now();if(a-Oa<10)return;Oa=a,h.value=e.currentTime||0;const t=Number.isFinite(e.duration)&&e.duration>0?e.duration:ht();i.value=t||0,N.value==="waveform"&&W()},Dt=()=>{const e=()=>{ra(),Te=requestAnimationFrame(e)};cancelAnimationFrame(Te),Te=requestAnimationFrame(e)},la=()=>{cancelAnimationFrame(Te),Te=0};let Le,De;const Va=()=>{Qe.value||!ze.value||(Qe.value=!0,$t(),yt(),St(),Pa())};return at(()=>{if(L.value.map(a=>a.key).includes(b.value)||(b.value=c.measurementKey),Le=new ResizeObserver(()=>{Mt()}),se.value&&Le.observe(se.value),se.value&&(De=new IntersectionObserver(a=>{const t=a[0];ze.value=!!(t!=null&&t.isIntersecting),ze.value&&Va()},{root:null,threshold:.15}),De.observe(se.value)),C.value&&(Wa(k.value),C.value.addEventListener("play",()=>{q.value=!0,M.value=!1,Dt()}),C.value.addEventListener("pause",()=>{q.value=!1,la()}),C.value.addEventListener("ended",()=>{q.value=!1,M.value=!0,la()}),C.value.addEventListener("loadedmetadata",()=>{ra()}),C.value.addEventListener("timeupdate",()=>{ra()})),de.value){const a=de.value,t=r=>{if(N.value!=="waveform"){ae.value=!1;return}if(!i.value){ae.value=!1;return}const o=a.getBoundingClientRect(),l=Math.min(Math.max(0,r.clientX-o.left),o.width),u=Math.max(0,o.width-28),_=h.value/i.value*u,w=Math.abs(l-_)<=4;w!==ae.value&&(ae.value=w,W())},n=()=>{ae.value&&(ae.value=!1,W())};a.addEventListener("mousemove",t),a.addEventListener("mouseleave",n),Za(()=>{a.removeEventListener("mousemove",t),a.removeEventListener("mouseleave",n)})}}),Za(()=>{Le==null||Le.disconnect(),De==null||De.disconnect(),la(),z.clear()}),te(()=>c.sampleName,()=>{Ke.value={},z.clear(),Qe.value=!1,ze.value&&Va()}),te(()=>b.value,()=>{M.value=!1,q.value=!1,he.value="",Pa()}),te(()=>pe.value,()=>{W()}),te(()=>me.value,()=>{W()}),te(()=>N.value,()=>{N.value==="spectrogram"&&(Y.value=!0),N.value!=="spectrogram"&&(Q.value=!1,Ne(fe.value),Ne(ne.value)),W()}),te(()=>c.defaultMethod,e=>{b.value=e}),te(()=>k.value,e=>{Wa(e)}),te(()=>le.value,()=>{z.clear(),N.value==="spectrogram"&&Da()}),(e,a)=>(p(),m("section",{ref_key:"containerRef",ref:se,class:"wave-compare"},[s("header",Hs,[s("div",js,[s("span",Os,[ha.value?(p(),m("span",Vs,S(ha.value),1)):I("",!0)]),s("span",Us,[a[10]||(a[10]=s("span",{class:"wave-desc-label"},"Sample name",-1)),s("span",Ys,S(ut.value),1)]),a[11]||(a[11]=s("span",{class:"wave-desc-divider","aria-hidden":"true"},null,-1)),s("span",Qs,[s("span",Zs,S(Ge.value.label),1),s("span",Js,S(Ge.value.value),1),Ge.value.tooltip?(p(),m("span",Xs,S(Ge.value.tooltip),1)):I("",!0)])])]),s("div",en,[s("div",an,[(p(!0),m(H,null,j(kt.value,t=>(p(),m("div",{key:t.key,class:"method-chip-wrap",onMouseenter:n=>Ka(n,t.key),onMouseleave:Fa},[s("button",{class:E(["method-chip",[`method-chip-${xt(t.key)}`,{active:b.value===t.key,playing:q.value&&he.value===t.key}]]),style:T(Ea(t.key)),disabled:!ie(t.key)||ya.value,onClick:n=>Aa(t.key),type:"button"},[a[12]||(a[12]=s("span",{class:"chip-dot","aria-hidden":"true"},null,-1)),s("span",nn,S(t.label),1),ie(t.key)?(p(),m("span",rn,[s("img",{class:"icon-img",src:za(t.key),alt:""},null,8,ln)])):(p(),m("span",on))],14,sn)],40,tn))),128))]),Ia.value.length?(p(),m("div",cn,[a[14]||(a[14]=s("span",{class:"method-group-label"},"Methods",-1)),s("div",un,[(p(!0),m(H,null,j(Ia.value,t=>(p(),m("div",{key:t.key,class:"method-chip-wrap",onMouseenter:n=>Ka(n,t.key),onMouseleave:Fa},[s("button",{class:E(["method-chip method-chip-secondary",{active:b.value===t.key,playing:q.value&&he.value===t.key}]),style:T(Ea(t.key)),disabled:!ie(t.key)||ya.value,onClick:n=>Aa(t.key),type:"button"},[a[13]||(a[13]=s("span",{class:"chip-dot","aria-hidden":"true"},null,-1)),s("span",_n,S(t.label),1),ie(t.key)?(p(),m("span",pn,[s("img",{class:"icon-img",src:za(t.key),alt:""},null,8,mn)])):(p(),m("span",fn))],14,vn)],40,dn))),128))])])):I("",!0)]),(p(),ia(It,{to:"body"},[be.value.visible?(p(),m("div",{key:0,class:"method-tip-global",style:T({left:`${be.value.x}px`,top:`${be.value.y}px`})},S(be.value.text),5)):I("",!0)])),s("div",hn,[s("div",gn,[s("div",bn,[s("span",{class:"legend-item",style:T({opacity:vt.value}),onMouseenter:a[0]||(a[0]=t=>pe.value="measurement"),onMouseleave:a[1]||(a[1]=t=>pe.value=null),onClick:a[2]||(a[2]=t=>qa("measurement"))},[s("span",{class:"legend-swatch legend-measurement","aria-hidden":"true",style:T({background:qe.value})},null,4),Ye(" "+S(fa.value),1)],36),P.value?(p(),m("span",{key:0,class:"legend-item",style:T({opacity:_t.value}),onMouseenter:a[3]||(a[3]=t=>pe.value="compare"),onMouseleave:a[4]||(a[4]=t=>pe.value=null),onClick:a[5]||(a[5]=t=>qa("compare"))},[s("span",{class:"legend-swatch legend-compare","aria-hidden":"true",style:T({background:We.value})},null,4),Ye(" "+S(_a.value),1)],36)):I("",!0)]),s("div",wn,[s("div",yn,[s("button",{class:E(["view-toggle-btn",{active:N.value==="waveform"}]),onClick:a[6]||(a[6]=t=>N.value="waveform"),type:"button"},"Waveform",2),s("button",{class:E(["view-toggle-btn",{active:N.value==="spectrogram"}]),onClick:a[7]||(a[7]=t=>N.value="spectrogram"),type:"button"},"Spectrogram",2)]),wa.value?(p(),m("span",{key:0,class:E(["wave-status",{"wave-status-error":Be.value||xe.value}])},S(wa.value),3)):I("",!0)])]),Me(s("div",Sn,[s("canvas",{ref_key:"combinedCanvasRef",ref:de,class:"wave-canvas"},null,512),U.value?(p(),m("div",Mn,"Loading...")):I("",!0)],512),[[Re,N.value==="waveform"]]),Me(s("div",Rn,[s("div",Bn,[(p(!0),m(H,null,j(ge.value,t=>(p(),m("span",{key:t,class:E(["time-axis-tick",{"is-major":t%2===0,"is-start":t===0,"is-end":t===it.value}]),style:T({left:`${i.value?t/i.value*100:0}%`})},[a[15]||(a[15]=s("span",{class:"time-axis-line"},null,-1)),s("span",xn,S(t%2===0?ce(t):""),1)],6))),128)),ae.value?(p(),m("div",{key:0,class:"time-axis-caret",style:T({left:`${lt.value}%`})},[s("span",kn,S(ce(h.value,!0)),1)],4)):I("",!0)])],512),[[Re,N.value==="waveform"]]),Me(s("div",Cn,[s("div",$n,[s("span",Nn,S(fa.value),1),a[16]||(a[16]=s("span",{class:"spectrogram-gap"},null,-1)),s("span",Tn,S(P.value?_a.value:""),1)]),s("div",Ln,[s("div",{class:E(["spectrogram-side",{"spectrogram-hovering":Q.value}]),onMousemove:a[8]||(a[8]=t=>Ha(t,"left")),onMouseleave:ja},[s("canvas",{ref_key:"spectrogramLeftRef",ref:ve,class:"spectrogram-canvas"},null,512),Me(s("canvas",{ref_key:"spectrogramZoomLeftRef",ref:fe,class:"spectrogram-zoom-canvas"},null,512),[[Re,Q.value]]),s("div",Dn,[a[18]||(a[18]=s("span",{class:"spectrogram-axis-title"},"Frequency[kHz]",-1)),(p(!0),m(H,null,j(pa.value,t=>(p(),m("span",{key:`y-${t}`,class:"spectrogram-axis-tick",style:T({top:`${100-t/8*100}%`})},[a[17]||(a[17]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",Pn,S(t),1)],4))),128))]),s("div",An,[(p(!0),m(H,null,j(ge.value,t=>(p(),m("span",{key:`x-left-${t}`,class:E(["spectrogram-axis-tick",{"is-major":t%2===0}]),style:T({left:`${i.value?t/i.value*100:0}%`})},[a[19]||(a[19]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",In,S(t%2===0?ce(t):""),1)],6))),128))]),Y.value?(p(),m("div",En,"Loading...")):I("",!0)],34),a[23]||(a[23]=s("div",{class:"spectrogram-gap"},null,-1)),s("div",{class:E(["spectrogram-side",{"spectrogram-hovering":Q.value}]),onMousemove:a[9]||(a[9]=t=>Ha(t,"right")),onMouseleave:ja},[s("canvas",{ref_key:"spectrogramRightRef",ref:_e,class:"spectrogram-canvas"},null,512),Me(s("canvas",{ref_key:"spectrogramZoomRightRef",ref:ne,class:"spectrogram-zoom-canvas"},null,512),[[Re,Q.value&&P.value]]),s("div",zn,[a[21]||(a[21]=s("span",{class:"spectrogram-axis-title"},"Frequency[kHz]",-1)),(p(!0),m(H,null,j(pa.value,t=>(p(),m("span",{key:`y2-${t}`,class:"spectrogram-axis-tick",style:T({top:`${100-t/8*100}%`})},[a[20]||(a[20]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",Kn,S(t),1)],4))),128))]),s("div",Fn,[(p(!0),m(H,null,j(ge.value,t=>(p(),m("span",{key:`x-right-${t}`,class:E(["spectrogram-axis-tick",{"is-major":t%2===0}]),style:T({left:`${i.value?t/i.value*100:0}%`})},[a[22]||(a[22]=s("span",{class:"spectrogram-axis-line"},null,-1)),s("span",qn,S(t%2===0?ce(t):""),1)],6))),128))]),P.value?I("",!0):(p(),m("span",Wn,"Select a method")),Y.value&&P.value?(p(),m("div",Gn,"Loading...")):I("",!0)],34)])],512),[[Re,N.value==="spectrogram"]]),Me(s("div",Hn,[a[25]||(a[25]=s("div",{class:"spectrogram-colorbar-wrap","aria-label":"Spectrogram energy scale"},[s("span",{class:"spectrogram-colorbar-label"},"0 dB"),s("div",{class:"spectrogram-colorbar"}),s("span",{class:"spectrogram-colorbar-label"},"-60 dB")],-1)),s("div",jn,[a[24]||(a[24]=s("span",{class:"spectrogram-quality-label"},"Quality",-1)),s("div",On,[(p(),m(H,null,j([1,2,3,4,5],t=>s("button",{key:`quality-${t}`,class:E(["spectrogram-quality-option",{active:le.value===t}]),onClick:n=>ft(t),type:"button"},S(t),11,Vn)),64))])])],512),[[Re,N.value==="spectrogram"]]),s("div",Un,[s("button",{class:"progress-play",type:"button",onClick:Bt,"aria-label":ma.value},[s("img",{class:"icon-img",src:ct.value,alt:ma.value},null,8,Qn)],8,Yn),s("span",Zn,S(ce(h.value)),1),s("div",{class:E(["progress-track",{"progress-track-hover":Ee.value}]),onMousemove:Tt,onMouseleave:Lt},[s("input",{class:"progress-bar",type:"range",min:"0",max:"100",step:"0.1",value:Je.value,style:T(nt.value),onInput:Nt},null,44,Jn),Ee.value?(p(),m("div",{key:0,class:"progress-tooltip",style:T({left:`${ua.value}px`})},S(rt.value),5)):I("",!0)],34),s("span",Xn,"-"+S(ce(ot.value)),1),s("div",eo,[s("button",{class:"volume-button",type:"button","aria-label":ba.value},[s("img",{class:"icon-img",src:dt.value,alt:ba.value},null,8,to)],8,ao),s("div",so,[s("div",no,S(ga.value),1),s("div",oo,[s("input",{class:"volume-slider",type:"range",min:"0",max:"200",step:"1",value:ga.value,onInput:Ct},null,40,ro)]),a[26]||(a[26]=s("div",{class:"volume-scale"},"0–200",-1))])])]),s("audio",{ref_key:"audioRef",ref:C,class:"wave-audio",src:Fe.value,preload:"metadata"},null,8,lo)])],512))}},Xa=et(co,[["__scopeId","data-v-44a5bff6"]]),uo={class:"rsb-page"},vo={class:"rsb-article"},_o={class:"rsb-section rsb-fade rsb-delay-5"},fo={class:"rsb-audio-group"},po={class:"rsb-audio-list"},mo={class:"rsb-audio-actions"},ho=["disabled"],go=["disabled"],bo={class:"rsb-audio-group"},wo={class:"rsb-audio-list"},yo={class:"rsb-audio-actions"},So=["disabled"],Mo=["disabled"],Ro={__name:"RSB",setup(ca){const k=["051o020a_c1_454_snr=5.2.wav","051o020t_c1_473_snr=8.3.wav","053c010d_c1_896_snr=1.1.wav","053c010k_c1_903_snr=-5.0.wav","421o0307_c1_1896_snr=8.7.wav"],c=["050a050v_c1_152_t60=1.57.wav","22gc0110_c1_1161_t60=1.72.wav","420c020o_c1_1633_t60=1.19.wav","421c0214_c2_1769_t60=1.86.wav","422c020d_c2_1982_t60=1.68.wav"],O=d(!1),L=d(!1),F=d(0),b=d(0),se=f(()=>O.value?k:[k[F.value]??k[0]].filter(Boolean)),de=f(()=>L.value?c:[c[b.value]??c[0]].filter(Boolean)),ve=()=>{k.length&&(F.value=(F.value-1+k.length)%k.length)},_e=()=>{k.length&&(F.value=(F.value+1)%k.length)},fe=()=>{c.length&&(b.value=(b.value-1+c.length)%c.length)},ne=()=>{c.length&&(b.value=(b.value+1)%c.length)},C=[{key:"Ground_Truth",label:"Ground Truth"},{key:"Measurement",label:"Measurement"},{key:"NCSN++M",label:"NCSN++M"},{key:"StoRM",label:"StoRM"},{key:"SB",label:"SB"},{key:"RSB",label:"RSB (Ours)"}],X=(h,i=1)=>h.toFixed(i).replace(/\.0+$/,"").replace(/(\.\d*[1-9])0+$/,"$1"),D=h=>h>=1e9?`${X(h/1e9)}B`:h>=1e6?`${X(h/1e6)}M`:h>=1e3?`${X(h/1e3)}K`:h.toString(),$=()=>{var V;const h=document.getElementById("busuanzi_value_site_pv");if(!h)return!1;const i=((V=h.textContent)==null?void 0:V.trim())??"";if(!i)return!1;const M=Number(i.replace(/,/g,""));return Number.isFinite(M)?(h.textContent=D(M),h.setAttribute("title",M.toLocaleString()),!0):!1},ee=()=>{$();const h=window.setInterval(()=>{$()&&window.clearInterval(h)},300),i=new MutationObserver(()=>{$()&&i.disconnect()}),M=document.getElementById("busuanzi_container_site_pv");M&&i.observe(M,{childList:!0,subtree:!0})};return at(()=>{if(!document.querySelector("script[data-busuanzi]")){const h=document.createElement("script");h.async=!0,h.src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",h.setAttribute("data-busuanzi","true"),document.body.appendChild(h)}ee()}),(h,i)=>(p(),m("section",uo,[s("article",vo,[i[5]||(i[5]=Ja('<img class="rsb-watermark" src="'+Et+'" alt="" aria-hidden="true" data-v-fe0b16ff><header class="rsb-hero rsb-fade rsb-delay-1" data-v-fe0b16ff><p class="rsb-kicker" data-v-fe0b16ff>Paper demo</p><h1 class="rsb-title" data-v-fe0b16ff> Regularized <span class="rsb-highlight" data-v-fe0b16ff>Schrödinger Bridge</span> via Distortion-Perception Perturbation for High-Fidelity <span class="rsb-highlight" data-v-fe0b16ff>Speech Enhancement</span></h1><p class="rsb-authors" data-v-fe0b16ff><span class="rsb-author" data-v-fe0b16ff><span class="rsb-author-name" data-v-fe0b16ff> Qing Yao <sup data-v-fe0b16ff>1</sup></span><span class="rsb-email" data-v-fe0b16ff>qyao@stmail.ujs.edu.cn</span></span><span class="rsb-author" data-v-fe0b16ff><span class="rsb-author-name" data-v-fe0b16ff> Lijian Gao <sup data-v-fe0b16ff>1</sup></span><span class="rsb-email" data-v-fe0b16ff>ljgao@ujs.edu.cn</span></span><span class="rsb-author" data-v-fe0b16ff><span class="rsb-author-name" data-v-fe0b16ff> Qirong Mao <sup data-v-fe0b16ff>1</sup><sup class="rsb-tag" data-v-fe0b16ff>†</sup></span><span class="rsb-email" data-v-fe0b16ff>mao_qr@ujs.edu.cn</span></span><span class="rsb-author" data-v-fe0b16ff><span class="rsb-author-name" data-v-fe0b16ff> Ming Dong <sup data-v-fe0b16ff>2</sup><sup class="rsb-tag" data-v-fe0b16ff>†</sup></span><span class="rsb-email" data-v-fe0b16ff>mdong@wayne.edu</span></span></p><ol class="rsb-affiliations" data-v-fe0b16ff><li data-v-fe0b16ff><sup data-v-fe0b16ff>1</sup> Jiangsu University </li><li data-v-fe0b16ff><sup data-v-fe0b16ff>2</sup> Wayne State University </li></ol><p class="rsb-affiliation-note" data-v-fe0b16ff><sup class="rsb-tag" data-v-fe0b16ff>†</sup> Corresponding Author </p></header><nav class="rsb-nav rsb-fade rsb-delay-2" data-v-fe0b16ff><span class="rsb-nav-title" data-v-fe0b16ff>Quick Access</span><a class="rsb-nav-link rsb-nav-disabled" href="" aria-label="Paper link" aria-disabled="true" tabindex="-1" data-v-fe0b16ff><span class="rsb-nav-icon rsb-nav-icon-demo" aria-hidden="true" data-v-fe0b16ff></span> Paper </a><a class="rsb-nav-link" href="https://github.com/Yorch233/RSB/" aria-label="Github repository link" aria-disabled="true" tabindex="-1" data-v-fe0b16ff><img class="rsb-nav-icon" src="https://github.githubassets.com/favicons/favicon.svg" alt="" data-v-fe0b16ff> Github </a><a class="rsb-nav-link" href="https://huggingface.co/Yorch233/RSB/" aria-label="Hugging Face repository link" aria-disabled="true" tabindex="-1" data-v-fe0b16ff><img class="rsb-nav-icon" src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" alt="" data-v-fe0b16ff> Hugging Face </a><a class="rsb-nav-link rsb-nav-disabled" href="https://huggingface.co/spaces/Yorch233/RSB/" aria-label="Online demo link" aria-disabled="true" tabindex="-1" data-v-fe0b16ff><img class="rsb-nav-icon" src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" alt="" data-v-fe0b16ff> Online Demo </a></nav><section class="rsb-section rsb-fade rsb-delay-3" data-v-fe0b16ff><h2 data-v-fe0b16ff><span class="rsb-wave" aria-hidden="true" data-v-fe0b16ff><span data-v-fe0b16ff></span></span> Abstract </h2><div class="rsb-abstract-wrap" data-v-fe0b16ff><p class="rsb-abstract" data-v-fe0b16ff><span class="rsb-highlight" data-v-fe0b16ff>Speech enhancement</span> (SE) requires high-fidelity reconstruction of clean speech that preserves linguistic and paralinguistic cues while maintaining high perceptual quality. Recently, <span class="rsb-highlight" data-v-fe0b16ff>Schrödinger Bridge</span> (SB), a family of diffusion-based generative models, has advanced SE by bridging degraded and clean speech distributions in a principled formulation, enabling higher-quality reconstructions with fewer sampling steps. However, diffusion-based SE methods still face two challenges: <span class="rsb-issue" data-v-fe0b16ff> (1) the fidelity-realism tradeoff, where they often prioritize perceptual realism encouraged by the learned speech prior, at the expense of fidelity; </span><span class="rsb-issue" data-v-fe0b16ff> (2) the exposure bias issue, where iterative multi-step sampling causes early-step prediction errors to accumulate along the sampling trajectory and degrade enhanced speech quality. </span> In this paper, we analyze standard SB training and show that it induces a systematic prediction drift, which biases the multi-step trajectory and amplifies error accumulation. To address this, we propose <span class="rsb-highlight" data-v-fe0b16ff>Regularized Schrödinger Bridge (RSB)</span> for high-fidelity SE, a generative approach that reconciles fidelity and realism while mitigating exposure bias. <span class="rsb-highlight" data-v-fe0b16ff>RSB regularizes training with a Distortion-Perception Perturbation</span> that constructs time-varying targets by interpolating between clean speech and posterior-mean estimates, and trains the network on perturbed intermediate states to correct toward the ground truth progressively. Consequently, such perturbation simulates inference-time prediction errors, mitigating the training–inference mismatch and thereby reducing exposure bias. Furthermore, it also injects posterior-mean estimates as fidelity-preserving guidance, facilitating reconstruction fidelity. Experiments on the WSJ0 corpus and VoiceBank+DEMAND dataset demonstrate that RSB improves reconstruction fidelity over the advanced SE baselines, yielding a favorable fidelity-realism tradeoff and reducing exposure bias. </p><div class="rsb-legend" aria-hidden="true" data-v-fe0b16ff><span class="rsb-legend-item" data-v-fe0b16ff><span class="rsb-legend-swatch rsb-legend-swatch-highlight" data-v-fe0b16ff></span> Key Concepts </span><span class="rsb-legend-item" data-v-fe0b16ff><span class="rsb-legend-swatch rsb-legend-swatch-issue" data-v-fe0b16ff></span> Issues </span></div></div></section><section class="rsb-section rsb-fade rsb-delay-4" data-v-fe0b16ff><h2 data-v-fe0b16ff><span class="rsb-wave" aria-hidden="true" data-v-fe0b16ff><span data-v-fe0b16ff></span></span> Keywords </h2><div class="rsb-meta" data-v-fe0b16ff><span class="rsb-chip" data-v-fe0b16ff>Speech enhancement</span><span class="rsb-chip" data-v-fe0b16ff>Schrödinger bridge</span><span class="rsb-chip" data-v-fe0b16ff>Diffusion models</span><span class="rsb-chip" data-v-fe0b16ff>Distortion-perception tradeoff</span><span class="rsb-chip" data-v-fe0b16ff>Exposure bias</span></div></section>',5)),s("section",_o,[i[4]||(i[4]=Ja('<h2 data-v-fe0b16ff><span class="rsb-wave" aria-hidden="true" data-v-fe0b16ff><span data-v-fe0b16ff></span></span> Audio Samples </h2><p class="rsb-muted" data-v-fe0b16ff> We publicly release <span class="rsb-accent" data-v-fe0b16ff>10 samples</span> in total, drawn from two synthetic datasets: <span class="rsb-accent" data-v-fe0b16ff>WSJ0+WHAM</span> is the denoising dataset and <span class="rsb-accent" data-v-fe0b16ff>WSJ0+REVERB</span> is the dereverberation dataset. </p>',2)),s("div",fo,[i[2]||(i[2]=s("h3",{class:"rsb-subtitle"},"WSJ0+WHAM (Denoising)",-1)),s("div",po,[(p(!0),m(H,null,j(se.value,(M,V)=>(p(),ia(Xa,{key:M,"sample-name":M,"sample-index":O.value?V+1:F.value+1,methods:C,"default-method":"Measurement"},null,8,["sample-name","sample-index"]))),128))]),s("div",mo,[s("button",{class:"rsb-nav-btn",type:"button",disabled:O.value,onClick:ve},"Previous",8,ho),s("button",{class:"rsb-show-more",type:"button",onClick:i[0]||(i[0]=M=>O.value=!O.value)},S(O.value?"Hiden":"Show More"),1),s("button",{class:"rsb-nav-btn",type:"button",disabled:O.value,onClick:_e},"Next",8,go)])]),s("div",bo,[i[3]||(i[3]=s("h3",{class:"rsb-subtitle"},"WSJ0+REVERB (Dereverberation)",-1)),s("div",wo,[(p(!0),m(H,null,j(de.value,(M,V)=>(p(),ia(Xa,{key:M,"sample-name":M,"sample-index":L.value?V+1:b.value+1,methods:C,"default-method":"Measurement"},null,8,["sample-name","sample-index"]))),128))]),s("div",yo,[s("button",{class:"rsb-nav-btn",type:"button",disabled:L.value,onClick:fe},"Previous",8,So),s("button",{class:"rsb-show-more",type:"button",onClick:i[1]||(i[1]=M=>L.value=!L.value)},S(L.value?"Hiden":"Show More"),1),s("button",{class:"rsb-nav-btn",type:"button",disabled:L.value,onClick:ne},"Next",8,Mo)])])])]),i[6]||(i[6]=s("footer",{class:"rsb-footer rsb-fade rsb-delay-5"},[s("span",{id:"busuanzi_container_site_pv"},[Ye(" Total site visits "),s("span",{id:"busuanzi_value_site_pv"}),Ye(" times ")]),s("span",{class:"rsb-footer-copy"},"© 2026 Qing Yao. All rights reserved.")],-1))]))}},xo=et(Ro,[["__scopeId","data-v-fe0b16ff"]]);export{xo as default};
